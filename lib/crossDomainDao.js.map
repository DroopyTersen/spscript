{"version":3,"sources":["../src/crossDomainDao.js"],"names":["SPScript","require","helpers","BaseDao","$","sp","CrossDomainDao","appWebUrl","hostUrl","appUrl","scriptReady","Deferred","window","SP","RequestExecutor","get","setTimeout","resolve","prototype","executeRequest","hostRelativeUrl","options","self","deferred","successCallback","response","data","parseJSON","body","success","validateODataV2","errorCallback","errorCode","errorMessage","error","reject","done","indexOf","executor","fullUrl","executeOptions","url","type","headers","extend","executeAsync","promise","module","exports"],"mappings":";;AAAAA,WAAWC,QAAQ,YAAR,CAAX;AACAD,SAASE,OAAT,GAAmBD,QAAQ,WAAR,CAAnB;AACAD,SAASG,OAAT,GAAmBF,QAAQ,WAAR,CAAnB;AACA,IAAIG,IAAIH,QAAQ,QAAR,CAAR;;AAEA,CAAC,UAASI,EAAT,EAAa;AACb,KAAIC,iBAAiB,SAAjBA,cAAiB,CAASC,SAAT,EAAoBC,OAApB,EAA6B;AACjD,OAAKC,MAAL,GAAcF,SAAd;AACA,OAAKC,OAAL,GAAeA,OAAf;AACA,OAAKE,WAAL,GAAmB,IAAIN,EAAEO,QAAN,EAAnB;;AAEA;AACA,MAAI,CAACC,OAAOC,EAAR,IAAc,CAACD,OAAOC,EAAP,CAAUC,eAA7B,EAA8C;AAC7C,QAAKJ,WAAL,GAAmBN,EAAEW,GAAF,CAAMP,UAAU,oCAAhB,EAAsD,IAAtD,EAA4D,IAA5D,EAAkE,QAAlE,CAAnB;AACA,GAFD,MAEO;AACNQ,cAAW,YAAW;AACrB,SAAKN,WAAL,CAAiBO,OAAjB;AACA,IAFD,EAEG,CAFH;AAGA;AACD,EAbD;;AAeAX,gBAAeY,SAAf,GAA2B,IAAIlB,SAASG,OAAb,EAA3B;;AAEAG,gBAAeY,SAAf,CAAyBC,cAAzB,GAA0C,UAASC,eAAT,EAA0BC,OAA1B,EAAmC;AAC5E,MAAIC,OAAO,IAAX;AAAA,MACCC,WAAW,IAAInB,EAAEO,QAAN,EADZ;;;AAGC;AACA;AACAa,oBAAkB,SAAlBA,eAAkB,CAASC,QAAT,EAAmB;AACpC,OAAIC,OAAOtB,EAAEuB,SAAF,CAAYF,SAASG,IAArB,CAAX;AACA;AACA,OAAIP,QAAQQ,OAAZ,EAAqB;AACpBR,YAAQQ,OAAR,CAAgBH,IAAhB,EAAsBH,QAAtB;AACA,IAFD,MAEO;AACN;AACAlB,OAAGH,OAAH,CAAW4B,eAAX,CAA2BJ,IAA3B,EAAiCH,QAAjC;AACA;AACD,GAdF;AAAA,MAeCQ,gBAAgB,SAAhBA,aAAgB,CAASL,IAAT,EAAeM,SAAf,EAA0BC,YAA1B,EAAwC;AACvD;AACA,OAAIZ,QAAQa,KAAZ,EAAmB;AAClBb,YAAQa,KAAR,CAAcR,IAAd,EAAoBM,SAApB,EAA+BC,YAA/B,EAA6CV,QAA7C;AACA,IAFD,MAEO;AACN;AACAA,aAASY,MAAT,CAAgBF,YAAhB;AACA;AACD,GAvBF;;AAyBA,OAAKvB,WAAL,CAAiB0B,IAAjB,CAAsB,YAAW;AAChC;AACA,OAAIhB,gBAAgBiB,OAAhB,CAAwB,GAAxB,MAAiC,CAAC,CAAtC,EAAyC;AACxCjB,sBAAkBA,kBAAkB,GAApC;AACA;;AAED,OAAIkB,WAAW,IAAIzB,GAAGC,eAAP,CAAuBQ,KAAKb,MAA5B,CAAf;AAAA,OACC8B,UAAUjB,KAAKb,MAAL,GAAc,kCAAd,GAAmDW,eAAnD,GAAqE,WAArE,GAAmFE,KAAKd,OAAxF,GAAkG,GAD7G;;AAGA,OAAIgC,iBAAiB;AACpBC,SAAKF,OADe;AAEpBG,UAAM,KAFc;AAGpBC,aAAS;AACR,eAAU;AADF,KAHW;AAMpBd,aAASL,eANW;AAOpBU,WAAOH;AAPa,IAArB;AASA;AACA3B,KAAEwC,MAAF,CAAS,IAAT,EAAeJ,cAAf,EAA+BnB,OAA/B;AACAiB,YAASO,YAAT,CAAsBL,cAAtB;AACA,GArBD;AAsBA,SAAOjB,SAASuB,OAAT,EAAP;AACA,EAjDD;;AAmDAzC,IAAGC,cAAH,GAAoBA,cAApB;AACA,CAtED,EAsEGN,QAtEH;;AAwEA+C,OAAOC,OAAP,GAAiBhD,SAASM,cAA1B","file":"crossDomainDao.js","sourcesContent":["SPScript = require(\"./spscript\");\r\nSPScript.helpers = require(\"./helpers\");\r\nSPScript.BaseDao = require(\"./baseDao\");\r\nvar $ = require(\"jquery\");\r\n\r\n(function(sp) {\r\n\tvar CrossDomainDao = function(appWebUrl, hostUrl) {\r\n\t\tthis.appUrl = appWebUrl;\r\n\t\tthis.hostUrl = hostUrl;\r\n\t\tthis.scriptReady = new $.Deferred();\r\n\r\n\t\t//Load of up to RequestExecutor javascript from the host site if its not there.\r\n\t\tif (!window.SP || !window.SP.RequestExecutor) {\r\n\t\t\tthis.scriptReady = $.get(hostUrl + \"/_layouts/15/SP.RequestExecutor.js\", null, null, \"script\");\r\n\t\t} else {\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tthis.scriptReady.resolve();\t\r\n\t\t\t}, 1);\r\n\t\t}\r\n\t};\r\n\r\n\tCrossDomainDao.prototype = new SPScript.BaseDao();\r\n\r\n\tCrossDomainDao.prototype.executeRequest = function(hostRelativeUrl, options) {\r\n\t\tvar self = this,\r\n\t\t\tdeferred = new $.Deferred(),\r\n\r\n\t\t\t//If a callback was given execute it, passing response then the deferred\r\n\t\t\t//otherwise just resolve the deferred.\r\n\t\t\tsuccessCallback = function(response) {\r\n\t\t\t\tvar data = $.parseJSON(response.body);\r\n\t\t\t\t//a suceess callback was passed in\r\n\t\t\t\tif (options.success) {\r\n\t\t\t\t\toptions.success(data, deferred);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//no success callback so just make sure its valid OData\r\n\t\t\t\t\tsp.helpers.validateODataV2(data, deferred);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terrorCallback = function(data, errorCode, errorMessage) {\r\n\t\t\t\t//an error callback was passed in\r\n\t\t\t\tif (options.error) {\r\n\t\t\t\t\toptions.error(data, errorCode, errorMessage, deferred);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//no error callback so just reject it\r\n\t\t\t\t\tdeferred.reject(errorMessage);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\tthis.scriptReady.done(function() {\r\n\t\t\t//tack on the query string question mark if not there already\r\n\t\t\tif (hostRelativeUrl.indexOf(\"?\") === -1) {\r\n\t\t\t\thostRelativeUrl = hostRelativeUrl + \"?\";\r\n\t\t\t}\r\n\r\n\t\t\tvar executor = new SP.RequestExecutor(self.appUrl),\r\n\t\t\t\tfullUrl = self.appUrl + \"/_api/SP.AppContextSite(@target)\" + hostRelativeUrl + \"@target='\" + self.hostUrl + \"'\";\r\n\r\n\t\t\tvar executeOptions = {\r\n\t\t\t\turl: fullUrl,\r\n\t\t\t\ttype: \"GET\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t\"Accept\": \"application/json; odata=verbose\"\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: successCallback,\r\n\t\t\t\terror: errorCallback\r\n\t\t\t};\r\n\t\t\t//Merge passed in options\r\n\t\t\t$.extend(true, executeOptions, options);\r\n\t\t\texecutor.executeAsync(executeOptions);\r\n\t\t});\r\n\t\treturn deferred.promise();\r\n\t};\r\n\r\n\tsp.CrossDomainDao = CrossDomainDao;\r\n})(SPScript);\r\n\r\nmodule.exports = SPScript.CrossDomainDao;"]}