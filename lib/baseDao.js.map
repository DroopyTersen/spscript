{"version":3,"sources":["../src/baseDao.js"],"names":["List","require","Web","Profiles","Search","utils","CustomActions","headerUtils","BaseDao","web","search","profiles","customActions","prototype","executeRequest","get","relativeQueryUrl","extendedOptions","options","method","then","parseJSON","getRequestDigest","post","data","d","GetContextWebInformation","FormDigestValue","lists","listname","validateODataV2","relativePostUrl","body","opts","packagePostBody","authorizedPost","verb","getActionHeaders","digest","headers","ensureRequestDigest","Promise","resolve","indexOf","JSON","stringify","module","exports"],"mappings":";;;;AACA,IAAIA,OAAUC,QAAQ,QAAR,CAAd;AACA,IAAIC,MAASD,QAAQ,OAAR,CAAb;AACA,IAAIE,WAAaF,QAAQ,YAAR,CAAjB;AACA,IAAIG,SAAYH,QAAQ,UAAR,CAAhB;AACA,IAAII,QAAWJ,QAAQ,SAAR,CAAf;AACA,IAAIK,gBAAiBL,QAAQ,iBAAR,CAArB;AACA,IAAIM,cAAkBN,QAAQ,kBAAR,CAAtB;AACA;;;;;;;;AAQA,IAAIO,UAAU,SAAVA,OAAU,GAAW;AACxB,MAAKC,GAAL,GAAW,IAAIP,GAAJ,CAAQ,IAAR,CAAX;AACA,MAAKQ,MAAL,GAAc,IAAIN,MAAJ,CAAW,IAAX,CAAd;AACA,MAAKO,QAAL,GAAgB,IAAIR,QAAJ,CAAa,IAAb,CAAhB;AACA,MAAKS,aAAL,GAAqB,IAAIN,aAAJ,CAAkB,IAAlB,CAArB;AAEA,CAND;;AAQAE,QAAQK,SAAR,CAAkBC,cAAlB,GAAmC,YAAW;AAC7C,OAAM,2BAAN;AACA,CAFD;;AAIA;;;;;;;;AAQAN,QAAQK,SAAR,CAAkBE,GAAlB,GAAwB,UAASC,gBAAT,EAA2BC,eAA3B,EAA4C;AACnE,KAAIC,UAAU,SAAc,EAAd,EAAkB;AAC/BC,UAAQ;AADuB,EAAlB,EAEXF,eAFW,CAAd;AAGA,QAAO,KAAKH,cAAL,CAAoBE,gBAApB,EAAsCE,OAAtC,EAA+CE,IAA/C,CAAoDf,MAAMgB,SAA1D,CAAP;AACA,CALD;;AAOAb,QAAQK,SAAR,CAAkBS,gBAAlB,GAAqC,YAAW;AAC/C,QAAO,KAAKC,IAAL,CAAU,cAAV,EAA0B,EAA1B,EACLH,IADK,CACA,gBAAQ;AACb,SAAOI,KAAKC,CAAL,CAAOC,wBAAP,CAAgCC,eAAvC;AACA,EAHK,CAAP;AAIA,CALD;AAMA;;;;;;;;;;AAUAnB,QAAQK,SAAR,CAAkBe,KAAlB,GAA0B,UAASC,QAAT,EAAmB;AAC5C,KAAI,CAACA,QAAL,EAAe;AACd,SAAO,KAAKd,GAAL,CAAS,YAAT,EAAuBK,IAAvB,CAA4Bf,MAAMyB,eAAlC,CAAP;AACA;AACD,QAAO,IAAI9B,IAAJ,CAAS6B,QAAT,EAAmB,IAAnB,CAAP;AACA,CALD;;AAOA;;;;;;AAMArB,QAAQK,SAAR,CAAkBU,IAAlB,GAAyB,UAASQ,eAAT,EAA0BC,IAA1B,EAAgCC,IAAhC,EAAsC;AAC9DD,QAAOE,gBAAgBF,IAAhB,EAAsBC,IAAtB,CAAP;AACA,KAAIf,UAAU;AACbC,UAAQ,MADK;AAEbK,QAAMQ;AAFO,EAAd;AAIAd,WAAU,SAAc,EAAd,EAAkBA,OAAlB,EAA2Be,IAA3B,CAAV;AACA,QAAO,KAAKnB,cAAL,CAAoBiB,eAApB,EAAqCb,OAArC,EAA8CE,IAA9C,CAAmDf,MAAMgB,SAAzD,CAAP;AACA,CARD;;AAUAb,QAAQK,SAAR,CAAkBsB,cAAlB,GAAmC,UAASJ,eAAT,EAA0BC,IAA1B,EAAgCI,IAAhC,EAAsC;AAAA;;AACxE,QAAO,KAAKd,gBAAL,GACLF,IADK,CACA;AAAA,SAAUb,YAAY8B,gBAAZ,CAA6BD,IAA7B,EAAmCE,MAAnC,CAAV;AAAA,EADA,EAELlB,IAFK,CAEA,mBAAW;AAChB,SAAO,MAAKG,IAAL,CAAUQ,eAAV,EAA2BC,IAA3B,EAAiC,EAAEO,gBAAF,EAAjC,CAAP;AACA,EAJK,CAAP;AAKA,CAND;;AAQA/B,QAAQK,SAAR,CAAkB2B,mBAAlB,GAAwC,UAASF,MAAT,EAAiB;AACxD,QAAOA,SAASG,QAAQC,OAAR,CAAgBJ,MAAhB,CAAT,GAAmC,KAAKhB,gBAAL,EAA1C;AACA,CAFD;;AAIA;AACA,IAAIY,kBAAkB,SAAlBA,eAAkB,CAASF,IAAT,EAAeC,IAAf,EAAqB;AAC1C;AACA,KAAI,OAAOD,IAAP,KAAgB,QAApB,EAA8B,OAAOA,IAAP;AAC9B;AACA,KAAIC,QAAQA,KAAKM,OAAb,IAAwBN,KAAKM,OAAL,CAAa,cAAb,CAAxB,IAAwDN,KAAKM,OAAL,CAAa,cAAb,EAA6BI,OAA7B,CAAqC,MAArC,MAAiD,CAAC,CAA9G,EAAiH;AAChH,SAAOX,IAAP;AACA;AACD;AACA,QAAOY,KAAKC,SAAL,CAAeb,IAAf,CAAP;AACA,CATD;AAUAc,OAAOC,OAAP,GAAiBvC,OAAjB","file":"baseDao.js","sourcesContent":["\r\nvar List \t\t\t= require(\"./list\");\r\nvar Web \t\t\t= require(\"./web\");\r\nvar Profiles \t\t= require(\"./profiles\")\r\nvar Search \t\t\t= require(\"./search\");\r\nvar utils \t\t\t= require(\"./utils\");\r\nvar CustomActions \t= require(\"./customActions\");\r\nvar headerUtils\t\t  \t= require(\"./requestHeaders\");\r\n/**\r\n * Abstract class. You'll never work with this directly. \r\n * @abstract\r\n * @private\r\n * @property {Web} web - Allows interacting with the SharePoint site you connected to\r\n * @property {Search} search - Allows querying through the SP Search Service\r\n * @property {Profiles} profiles - Allows interacting with the SP Profile Service\r\n */\r\nvar BaseDao = function() {\r\n\tthis.web = new Web(this);\r\n\tthis.search = new Search(this);\r\n\tthis.profiles = new Profiles(this);\r\n\tthis.customActions = new CustomActions(this);\r\n\r\n};\r\n\r\nBaseDao.prototype.executeRequest = function() {\r\n\tthrow \"Not implemented exception\";\r\n};\r\n\r\n/**\r\n * Generic helper to make AJAX GET request\r\n  * @example <caption>Use generic GET method to retrieve a site's content types</caption>\r\n * dao.get('/web/contentTypes').then(function(data) { console.log(data.d.results)})\r\n * @param {string} relativeQueryUrl - the API url relative to \"/_api\"\r\n * @param {Object} [extendedOptions] - AJAX options (like custom request headers)\r\n * @returns {Promise} - An ES6 Promise that resolves to the an object probably in the form of data.d\r\n */\r\nBaseDao.prototype.get = function(relativeQueryUrl, extendedOptions) {\r\n\tvar options = Object.assign({}, {\r\n\t\tmethod: \"GET\"\r\n\t}, extendedOptions);\r\n\treturn this.executeRequest(relativeQueryUrl, options).then(utils.parseJSON);\r\n};\r\n\r\nBaseDao.prototype.getRequestDigest = function() {\r\n\treturn this.post('/contextinfo', {})\r\n\t\t.then(data => {\r\n\t\t\treturn data.d.GetContextWebInformation.FormDigestValue\r\n\t\t});\r\n};\r\n/**\r\n * If a list name is passed, an SPScript.List object, otherwise performs a request to get all the site's lists\r\n * @param {string} [listname] - If a list name is passed, method is synchronous returning an SPScript.List\r\n * @returns {List|Promise} - SPScript.List object or a Promise that resolves to an Array of lists\r\n * @example <caption>Option 1: No List Name gets all the lists of a site</caption>\r\n * dao.lists().then(function(lists) { console.log(lists)});\r\n * @example <caption>Option 2: Pass a List Name to get a list object</caption>\r\n * var list = dao.lists('MyList');\r\n * list.getItemById(12).then(function(item) { console.log(item)});\r\n */\r\nBaseDao.prototype.lists = function(listname) {\r\n\tif (!listname) {\r\n\t\treturn this.get(\"/web/lists\").then(utils.validateODataV2);\r\n\t}\r\n\treturn new List(listname, this);\r\n};\r\n\r\n/**\r\n * Generic helper to make AJAX POST request\r\n * @param {string} relativeQueryUrl - the API url relative to \"/_api\"\r\n * @param {Object} [extendedOptions] - AJAX options (like custom request headers)\r\n * @returns {Promise} - An ES6 Promise\r\n */\r\nBaseDao.prototype.post = function(relativePostUrl, body, opts) {\r\n\tbody = packagePostBody(body, opts);\r\n\tvar options = {\r\n\t\tmethod: \"POST\",\r\n\t\tdata: body\r\n\t};\r\n\toptions = Object.assign({}, options, opts);\r\n\treturn this.executeRequest(relativePostUrl, options).then(utils.parseJSON);\r\n};\r\n\r\nBaseDao.prototype.authorizedPost = function(relativePostUrl, body, verb) {\r\n\treturn this.getRequestDigest()\r\n\t\t.then(digest => headerUtils.getActionHeaders(verb, digest))\r\n\t\t.then(headers => {\r\n\t\t\treturn this.post(relativePostUrl, body, { headers })\r\n\t\t});\r\n};\r\n\r\nBaseDao.prototype.ensureRequestDigest = function(digest) {\r\n\treturn digest ? Promise.resolve(digest) : this.getRequestDigest();\r\n}\r\n\r\n//Skip stringify it its already a string or it has an explicit Content-Type that is not JSON\r\nvar packagePostBody = function(body, opts) {\r\n\t// if its already a string just return\r\n\tif (typeof body === \"string\") return body;\r\n\t// if it has an explicit content-type, asssume the body is already that type\r\n\tif (opts && opts.headers && opts.headers[\"Content-Type\"] && opts.headers[\"Content-Type\"].indexOf(\"json\") === -1) {\r\n\t\treturn body\r\n\t}\r\n\t//others stringify\r\n\treturn JSON.stringify(body);\r\n}\r\nmodule.exports = BaseDao;"]}