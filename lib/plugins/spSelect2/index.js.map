{"version":3,"sources":["../../../src/plugins/spSelect2/index.js"],"names":["global","loadDependencies","SPScript","utils","loadCss","select2Url","scripts","window","jQuery","push","validateNamespace","getScripts","init","field","list","options","selector","getSelect2Value","fieldCtx","value","document","querySelector","fieldSchema","FieldType","join","setupSelect2","dao","defaults","minimumInputLength","placeholder","ajax","delay","processResults","items","results","map","item","id","Id","Title","text","cache","transport","params","success","failure","search","data","q","odata","lists","getItems","then","catch","$","select2","convertToSelect2","ctx","SPClientTemplates","Utility","GetFormContextForCurrentField","RestDao","webAttributes","WebUrl","isMultple","dropdownHtml","fieldName","isMultiple","waitForLibraries","jsLink","registerEditField","spSelect2"],"mappings":"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","file":"index.js","sourcesContent":["(function(global) {\r\n\"use strict\";\r\n\r\nvar loadDependencies = function() {\r\n\t//add select 2 css\r\n\tSPScript.utils.loadCss(\"//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css\");\r\n\tvar select2Url = \"//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js\"\r\n\tvar scripts = []\r\n\t// load jQuery if its not on the page\r\n\tif (!window.jQuery) {\r\n\t\tscripts.push(\"//code.jquery.com/jquery-2.2.3.min.js\");\r\n\t}\r\n\t// load select2 if its not on the page\r\n\tif (!SPScript.utils.validateNamespace(\"jQuery.fn.select2\")) {\r\n\t\tscripts.push(select2Url);\r\n\t}\r\n\treturn SPScript.utils.getScripts(scripts);\r\n};\r\n\r\nvar init = function init(field, list, options) {\r\n\tvar selector = \"[name='\" + field + \"']\";\r\n\r\n\tvar getSelect2Value = function(fieldCtx) {\r\n\t\tvar value = document.querySelector(selector).value;\r\n\t\tif (fieldCtx.fieldSchema.FieldType === \"LookupMulti\") {\r\n\t\t\tvalue = value.join(\";#\");\r\n\t\t}\r\n\t\treturn value;\r\n\t};\r\n\r\n\tvar setupSelect2 = function(dao) {\r\n\t\tvar defaults = {\r\n\t\t\tminimumInputLength: 1,\r\n\t\t\tplaceholder: \"Begin typing...\",\r\n\t\t\tajax: {\r\n\t\t\t\tdelay: 150,\r\n\t\t\t\tprocessResults: function processResults(items) {\r\n\t\t\t\t\tvar results = items.map(function(item) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tid: item.Id + \";#\" + item.Title,\r\n\t\t\t\t\t\t\ttext: item.Title\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn { results };\r\n\t\t\t\t},\r\n\t\t\t\tcache: true,\r\n\t\t\t\ttransport: function (params, success, failure) {\r\n\t\t\t\t\tvar search = params.data.q || \"\";\r\n\t\t\t\t\tvar odata = \"$top=10&$select=Title, Id&$filter=substringof('\" + search + \"', Title)\";\r\n\t\t\t\t\tdao.lists(list).getItems(odata).then(success).catch(failure);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\toptions = Object.assign({}, defaults, options);\r\n\t\t$(selector).select2(options);\r\n\t};\r\n\r\n\tvar convertToSelect2 = function convertToSelect2(ctx) {\r\n\t\tvar fieldCtx = SPClientTemplates.Utility.GetFormContextForCurrentField(ctx);\r\n\t\tvar dao = new SPScript.RestDao(fieldCtx.webAttributes.WebUrl);\r\n\r\n\t\tvar isMultple = fieldCtx.fieldSchema.FieldType === \"LookupMulti\" ? \"multiple='multple'\" : \"\";\r\n\r\n\t\tvar dropdownHtml = \r\n\t\t\t`<select id='${fieldCtx.fieldName}' ${isMultiple} class='ms-long' name='${fieldCtx.fieldName}'>\r\n\t\t\t\t<option value=''></option>\r\n\t\t\t</select>`; \r\n\r\n\t\tSPScript.utils.waitForLibraries([\"jQuery\", \"jQuery.fn.select2\"]).then(() => setupSelect2(dao));\r\n\r\n\t\treturn dropdownHtml;\r\n\t};\r\n\r\n\tloadDependencies();\r\n\tSPScript.jsLink.registerEditField(field, convertToSelect2, getSelect2Value);\r\n};\r\n\tglobal.spSelect2 = { init };\r\n})(window);\r\n"]}