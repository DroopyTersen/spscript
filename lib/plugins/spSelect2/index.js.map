{"version":3,"sources":["../../../src/plugins/spSelect2/index.js"],"names":[],"mappings":";;;;AAAA,CAAC,UAAS,MAAT,EAAiB;AAClB;;AAEA,KAAI,mBAAmB,SAAnB,gBAAmB,GAAW;;AAEjC,WAAS,KAAT,CAAe,OAAf,CAAuB,oEAAvB;AACA,MAAI,aAAa,kEAAjB;AACA,MAAI,UAAU,EAAd;;AAEA,MAAI,CAAC,OAAO,MAAZ,EAAoB;AACnB,WAAQ,IAAR,CAAa,uCAAb;AACA;;AAED,MAAI,CAAC,SAAS,KAAT,CAAe,iBAAf,CAAiC,mBAAjC,CAAL,EAA4D;AAC3D,WAAQ,IAAR,CAAa,UAAb;AACA;AACD,SAAO,SAAS,KAAT,CAAe,UAAf,CAA0B,OAA1B,CAAP;AACA,EAdD;;AAgBA,KAAI,OAAO,SAAS,IAAT,CAAc,KAAd,EAAqB,IAArB,EAA2B,OAA3B,EAAoC;AAC9C,MAAI,WAAW,YAAY,KAAZ,GAAoB,IAAnC;;AAEA,MAAI,kBAAkB,SAAlB,eAAkB,CAAS,QAAT,EAAmB;AACxC,OAAI,QAAQ,SAAS,aAAT,CAAuB,QAAvB,EAAiC,KAA7C;AACA,OAAI,SAAS,WAAT,CAAqB,SAArB,KAAmC,aAAvC,EAAsD;AACrD,YAAQ,MAAM,IAAN,CAAW,IAAX,CAAR;AACA;AACD,UAAO,KAAP;AACA,GAND;;AAQA,MAAI,eAAe,SAAf,YAAe,CAAS,GAAT,EAAc;AAChC,OAAI,WAAW;AACd,wBAAoB,CADN;AAEd,iBAAa,iBAFC;AAGd,UAAM;AACL,YAAO,GADF;AAEL,qBAAgB,SAAS,cAAT,CAAwB,KAAxB,EAA+B;AAC9C,UAAI,UAAU,MAAM,GAAN,CAAU,UAAS,IAAT,EAAe;AACtC,cAAO;AACN,YAAI,KAAK,EAAL,GAAU,IAAV,GAAiB,KAAK,KADpB;AAEN,cAAM,KAAK;AAFL,QAAP;AAIA,OALa,CAAd;AAMA,aAAO,EAAE,gBAAF,EAAP;AACA,MAVI;AAWL,YAAO,IAXF;AAYL,gBAAW,mBAAU,MAAV,EAAkB,OAAlB,EAA2B,OAA3B,EAAoC;AAC9C,UAAI,SAAS,OAAO,IAAP,CAAY,CAAZ,IAAiB,EAA9B;AACA,UAAI,QAAQ,oDAAoD,MAApD,GAA6D,WAAzE;AACA,UAAI,KAAJ,CAAU,IAAV,EAAgB,QAAhB,CAAyB,KAAzB,EAAgC,IAAhC,CAAqC,OAArC,EAA8C,KAA9C,CAAoD,OAApD;AACA;AAhBI;AAHQ,IAAf;;AAuBA,aAAU,SAAc,EAAd,EAAkB,QAAlB,EAA4B,OAA5B,CAAV;AACA,KAAE,QAAF,EAAY,OAAZ,CAAoB,OAApB;AACA,GA1BD;;AA4BA,MAAI,mBAAmB,SAAS,gBAAT,CAA0B,GAA1B,EAA+B;AACrD,OAAI,WAAW,kBAAkB,OAAlB,CAA0B,6BAA1B,CAAwD,GAAxD,CAAf;AACA,OAAI,MAAM,IAAI,SAAS,OAAb,CAAqB,SAAS,aAAT,CAAuB,MAA5C,CAAV;;AAEA,OAAI,YAAY,SAAS,WAAT,CAAqB,SAArB,KAAmC,aAAnC,GAAmD,oBAAnD,GAA0E,EAA1F;;AAEA,OAAI,gCACY,SAAS,SADrB,UACmC,UADnC,+BACuE,SAAS,SADhF,4DAAJ;;AAKA,YAAS,KAAT,CAAe,gBAAf,CAAgC,CAAC,QAAD,EAAW,mBAAX,CAAhC,EAAiE,IAAjE,CAAsE;AAAA,WAAM,aAAa,GAAb,CAAN;AAAA,IAAtE;;AAEA,UAAO,YAAP;AACA,GAdD;;AAgBA;AACA,WAAS,MAAT,CAAgB,iBAAhB,CAAkC,KAAlC,EAAyC,gBAAzC,EAA2D,eAA3D;AACA,EAzDD;AA0DC,QAAO,SAAP,GAAmB,EAAE,UAAF,EAAnB;AACA,CA9ED,EA8EG,MA9EH","file":"index.js","sourcesContent":["(function(global) {\r\n\"use strict\";\r\n\r\nvar loadDependencies = function() {\r\n\t//add select 2 css\r\n\tSPScript.utils.loadCss(\"//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css\");\r\n\tvar select2Url = \"//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js\"\r\n\tvar scripts = []\r\n\t// load jQuery if its not on the page\r\n\tif (!window.jQuery) {\r\n\t\tscripts.push(\"//code.jquery.com/jquery-2.2.3.min.js\");\r\n\t}\r\n\t// load select2 if its not on the page\r\n\tif (!SPScript.utils.validateNamespace(\"jQuery.fn.select2\")) {\r\n\t\tscripts.push(select2Url);\r\n\t}\r\n\treturn SPScript.utils.getScripts(scripts);\r\n};\r\n\r\nvar init = function init(field, list, options) {\r\n\tvar selector = \"[name='\" + field + \"']\";\r\n\r\n\tvar getSelect2Value = function(fieldCtx) {\r\n\t\tvar value = document.querySelector(selector).value;\r\n\t\tif (fieldCtx.fieldSchema.FieldType === \"LookupMulti\") {\r\n\t\t\tvalue = value.join(\";#\");\r\n\t\t}\r\n\t\treturn value;\r\n\t};\r\n\r\n\tvar setupSelect2 = function(dao) {\r\n\t\tvar defaults = {\r\n\t\t\tminimumInputLength: 1,\r\n\t\t\tplaceholder: \"Begin typing...\",\r\n\t\t\tajax: {\r\n\t\t\t\tdelay: 150,\r\n\t\t\t\tprocessResults: function processResults(items) {\r\n\t\t\t\t\tvar results = items.map(function(item) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tid: item.Id + \";#\" + item.Title,\r\n\t\t\t\t\t\t\ttext: item.Title\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn { results };\r\n\t\t\t\t},\r\n\t\t\t\tcache: true,\r\n\t\t\t\ttransport: function (params, success, failure) {\r\n\t\t\t\t\tvar search = params.data.q || \"\";\r\n\t\t\t\t\tvar odata = \"$top=10&$select=Title, Id&$filter=substringof('\" + search + \"', Title)\";\r\n\t\t\t\t\tdao.lists(list).getItems(odata).then(success).catch(failure);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\toptions = Object.assign({}, defaults, options);\r\n\t\t$(selector).select2(options);\r\n\t};\r\n\r\n\tvar convertToSelect2 = function convertToSelect2(ctx) {\r\n\t\tvar fieldCtx = SPClientTemplates.Utility.GetFormContextForCurrentField(ctx);\r\n\t\tvar dao = new SPScript.RestDao(fieldCtx.webAttributes.WebUrl);\r\n\r\n\t\tvar isMultple = fieldCtx.fieldSchema.FieldType === \"LookupMulti\" ? \"multiple='multple'\" : \"\";\r\n\r\n\t\tvar dropdownHtml = \r\n\t\t\t`<select id='${fieldCtx.fieldName}' ${isMultiple} class='ms-long' name='${fieldCtx.fieldName}'>\r\n\t\t\t\t<option value=''></option>\r\n\t\t\t</select>`; \r\n\r\n\t\tSPScript.utils.waitForLibraries([\"jQuery\", \"jQuery.fn.select2\"]).then(() => setupSelect2(dao));\r\n\r\n\t\treturn dropdownHtml;\r\n\t};\r\n\r\n\tloadDependencies();\r\n\tSPScript.jsLink.registerEditField(field, convertToSelect2, getSelect2Value);\r\n};\r\n\tglobal.spSelect2 = { init };\r\n})(window);\r\n"]}