{"version":3,"sources":["../../../src/plugins/SPFileTree/spfiletree.jquery.js"],"names":["$","sp","pluginName","Folder","spItem","url","ServerRelativeUrl","parentUrl","ParentFolder","name","Name","_spItem","folders","files","prototype","toHtml","html","forEach","folder","file","File","replace","SPFileTree","element","options","_defaults","webUrl","_spPageContextInfo","webAbsoluteUrl","_name","extend","select","odata","library","rootFolderUrl","$elem","_dao","init","_sortByUrl","a","b","_sortByParentUrl","getFiles","folderUrl","j","allFiles","length","push","fileIndex","_recursivePopulateChildFolders","parentFolder","i","self","recursiveResult","getFilesResult","allFolders","index","unflatten","items","item","sort","rootFolder","console","log","getListInfo","lists","info","then","ParentWebUrl","getItems","RestDao","bind","libraryFolder","call","fancytree","fn","each","jQuery","SPScript"],"mappings":"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","file":"spfiletree.jquery.js","sourcesContent":["(function ($, sp) {\r\n\tvar pluginName = \"spFileTree\";\r\n\r\n\tvar Folder = function (spItem) {\r\n\t\tthis.url = spItem.Folder.ServerRelativeUrl;\r\n\t\tthis.parentUrl = spItem.Folder.ParentFolder.ServerRelativeUrl;\r\n\t\tthis.name = spItem.Folder.Name;\r\n\t\tthis._spItem = spItem;\r\n\t\tthis.folders = [];\r\n\t\tthis.files = [];\r\n\t};\r\n\r\n\tFolder.prototype.toHtml = function() {\r\n\t\tvar html = \"<li class='folder'>\" + this.name;\r\n\t\thtml += \"<ul>\";\r\n\t\tthis.folders.forEach(function(folder){\r\n\t\t\thtml += folder.toHtml();\r\n\t\t});\r\n\t\tthis.files.forEach(function(file){\r\n\t\t\thtml += file.toHtml();\r\n\t\t});\r\n\t\thtml += \"</ul></li>\";\r\n\r\n\t\treturn html;\r\n\t};\r\n\t\r\n\tvar File = function (spItem) {\r\n\t\tthis.url = spItem.File.ServerRelativeUrl;\r\n\t\tthis.parentUrl = spItem.File.ServerRelativeUrl.replace(\"/\" + spItem.File.Name, \"\");\r\n\t\tthis.name = spItem.File.Name;\r\n\t\t//this._spItem = spItem;\r\n\t};\r\n\r\n\tFile.prototype.toHtml = function() {\r\n\t\treturn \"<li class='file'><a href='\" + this.url + \"'>\" + this.name + \"</a></li>\";\r\n\t};\r\n\t\r\n\tvar SPFileTree = function (element, options) {\r\n\t\tthis._defaults = {\r\n\t\t\twebUrl: _spPageContextInfo.webAbsoluteUrl\r\n\t\t};\r\n\t\tthis._name = pluginName;\r\n\t\tthis.options = $.extend(this._defaults, options);\r\n\t\tvar select = \"&$select=File/ServerRelativeUrl, Folder/ServerRelativeUrl, Folder/ParentFolder/ServerRelativeUrl, Folder/Name, File/Name\";\r\n\t\tthis.options.odata = \"$expand=Folder,File,Folder/ParentFolder&$top=2000\" + select;\r\n\t\tthis.library = {\r\n\t\t\tname: options.library\r\n\t\t};\r\n\t\tthis.rootFolderUrl = \"/sites/FoodServices/Style Library\";\r\n\t\tthis.$elem = $(element);\r\n\t\tthis._dao = null;\r\n\t\tthis.init();\r\n\t};\r\n\r\n\tvar _sortByUrl = function (a, b) {\r\n\t\tif (a.url < b.url) {\r\n\t\t\treturn -1;\r\n\t\t} else if (a.url > b.url) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t};\r\n\r\n\tvar _sortByParentUrl = function (a, b) {\r\n\t\tif (a.parentUrl < b.parentUrl) {\r\n\t\t\treturn -1;\r\n\t\t} else if (a.parentUrl > b.parentUrl) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t};\r\n\t\r\n\tSPFileTree.prototype.getFiles = function(folderUrl, j) {\r\n\t\tvar files = [];\r\n\t\twhile (j < this.allFiles.length && this.allFiles[j].parentUrl === folderUrl) {\r\n\t\t\tfiles.push(this.allFiles[j]);\r\n\t\t\tj++;\r\n\t\t}\r\n\t\treturn { files: files, fileIndex: j };\r\n\t};\r\n\r\n\tSPFileTree.prototype._recursivePopulateChildFolders = function(parentFolder, i, j) {\r\n\t\tvar self = this;\r\n\t\tvar recursiveResult;\r\n\t\tvar getFilesResult;\r\n\t\twhile (i < self.allFolders.length) {\r\n\t\t\t// 1. next folder is a child folder\r\n\r\n\t\t\tif (self.allFolders[i].parentUrl === parentFolder.url) {\r\n\t\t\t\tgetFilesResult = self.getFiles(self.allFolders[i].url, j);\r\n\t\t\t\tj = getFilesResult.fileIndex;\r\n\t\t\t\r\n\t\t\t\trecursiveResult = self._recursivePopulateChildFolders(self.allFolders[i], i + 1, j);\r\n\t\t\t\trecursiveResult.folder.files = getFilesResult.files;\r\n\t\t\t\tparentFolder.folders.push(recursiveResult.folder);\r\n\t\t\t\ti = recursiveResult.index;\r\n\t\t\t\tj = recursiveResult.fileIndex;\r\n\t\t\t}\r\n\t\t\t// 2. next folder is a sibling\r\n\t\t\telse if (self.allFolders[i].parentUrl === parentFolder.parentUrl) {\r\n\t\t\t\t// Return the parent folder (sibling A) to be pushed on the parent's folder array, \r\n\t\t\t\t// Don't increment the index so sibling B will get processed as a child folder once it pops up the recursive chain\r\n\t\t\t\treturn { folder: parentFolder, index: i, fileIndex: j };\r\n\t\t\t}\r\n\t\t\t// 3. next folder pops back up the tree\r\n\t\t\telse if (self.allFolders[i].url.length < parentFolder.url.length) {\r\n\t\t\t\treturn { folder: parentFolder, index: i, fileIndex: j };\r\n\t\t\t} \r\n\t\t\telse {\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { folder: parentFolder, index: i, fileIndex: j };\r\n\t};\r\n\t\r\n\tSPFileTree.prototype.unflatten = function (items) {\r\n\t\t//sort them?\r\n\t\tvar self = this;\r\n\t\tvar allFolders = [];\r\n\t\tvar allFiles = [];\r\n\t\titems.forEach(function (item) {\r\n\t\t\tif (item.Folder && item.Folder.ServerRelativeUrl) {\r\n\t\t\t\tallFolders.push(new Folder(item));\r\n\t\t\t\t// allFolders[item.Folder.ServerRelativeUrl] = { item: item };\r\n\t\t\t} else if (item.File && item.File.ServerRelativeUrl) {\r\n\t\t\t\tallFiles.push(new File(item));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tallFolders.sort(_sortByUrl);\r\n\t\tallFiles.sort(_sortByParentUrl);\r\n\t\tself.allFolders = allFolders;\r\n\t\tself.allFiles = allFiles;\r\n\t\tvar rootFolder = {\r\n\t\t\tname: self.library.name,\r\n\t\t\turl: \"/sites/FoodServices/Style Library\",\r\n\t\t\tparentUrl: self.library.parentUrl,\r\n\t\t\tfolders: [],\r\n\t\t\tfiles: [],\r\n\t\t};\r\n\t\tvar recursiveResult = self._recursivePopulateChildFolders(rootFolder, 0, 0);\r\n\t\tconsole.log(recursiveResult);\r\n\t\treturn recursiveResult.folder;\r\n\t}\r\n\t\r\n\tSPFileTree.prototype.getListInfo = function() {\r\n\t\tvar self = this;\r\n\t\treturn this._dao.lists(this.library.name).info().then(function(info){\r\n\t\t\tself.library.parentUrl = info.ParentWebUrl;\r\n\t\t\tconsole.log(info);\r\n\t\t})\r\n\t};\r\n\t\r\n\tSPFileTree.prototype.getItems = function() {\r\n\t\treturn this._dao.lists(this.library.name).getItems(this.options.odata);\r\n\t};\r\n\tSPFileTree.prototype.init = function () {\r\n\t\tvar self = this;\r\n\t\tthis._dao = new sp.RestDao(this.options.webUrl);\r\n\t\tthis.getListInfo()\r\n\t\t\t.then(self.getItems.bind(self))\r\n            .then(self.unflatten.bind(self))\r\n\t\t\t.then(function (libraryFolder) {\r\n\t\t\t\tvar html = \"<ul class='treedata' style='display:none'>\";\r\n\t\t\t\thtml += Folder.prototype.toHtml.call(libraryFolder) + \"</ul>\";\r\n\t\t\t\tself.$elem.html(html).fancytree();\r\n\t\t\t});\r\n\t};\r\n\r\n\t$.fn[pluginName] = function (options) {\r\n\t\treturn this.each(function () {\r\n\t\t\treturn new SPFileTree(this, options);\r\n\t\t});\r\n\t};\r\n\r\n})(jQuery, SPScript);"]}