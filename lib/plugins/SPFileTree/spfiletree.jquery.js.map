{"version":3,"sources":["../../../src/plugins/SPFileTree/spfiletree.jquery.js"],"names":[],"mappings":"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","file":"spfiletree.jquery.js","sourcesContent":["(function ($, sp) {\r\n\tvar pluginName = \"spFileTree\";\r\n\r\n\tvar Folder = function (spItem) {\r\n\t\tthis.url = spItem.Folder.ServerRelativeUrl;\r\n\t\tthis.parentUrl = spItem.Folder.ParentFolder.ServerRelativeUrl;\r\n\t\tthis.name = spItem.Folder.Name;\r\n\t\tthis._spItem = spItem;\r\n\t\tthis.folders = [];\r\n\t\tthis.files = [];\r\n\t};\r\n\r\n\tFolder.prototype.toHtml = function() {\r\n\t\tvar html = \"<li class='folder'>\" + this.name;\r\n\t\thtml += \"<ul>\";\r\n\t\tthis.folders.forEach(function(folder){\r\n\t\t\thtml += folder.toHtml();\r\n\t\t});\r\n\t\tthis.files.forEach(function(file){\r\n\t\t\thtml += file.toHtml();\r\n\t\t});\r\n\t\thtml += \"</ul></li>\";\r\n\r\n\t\treturn html;\r\n\t};\r\n\t\r\n\tvar File = function (spItem) {\r\n\t\tthis.url = spItem.File.ServerRelativeUrl;\r\n\t\tthis.parentUrl = spItem.File.ServerRelativeUrl.replace(\"/\" + spItem.File.Name, \"\");\r\n\t\tthis.name = spItem.File.Name;\r\n\t\t//this._spItem = spItem;\r\n\t};\r\n\r\n\tFile.prototype.toHtml = function() {\r\n\t\treturn \"<li class='file'><a href='\" + this.url + \"'>\" + this.name + \"</a></li>\";\r\n\t};\r\n\t\r\n\tvar SPFileTree = function (element, options) {\r\n\t\tthis._defaults = {\r\n\t\t\twebUrl: _spPageContextInfo.webAbsoluteUrl\r\n\t\t};\r\n\t\tthis._name = pluginName;\r\n\t\tthis.options = $.extend(this._defaults, options);\r\n\t\tvar select = \"&$select=File/ServerRelativeUrl, Folder/ServerRelativeUrl, Folder/ParentFolder/ServerRelativeUrl, Folder/Name, File/Name\";\r\n\t\tthis.options.odata = \"$expand=Folder,File,Folder/ParentFolder&$top=2000\" + select;\r\n\t\tthis.library = {\r\n\t\t\tname: options.library\r\n\t\t};\r\n\t\tthis.rootFolderUrl = \"/sites/FoodServices/Style Library\";\r\n\t\tthis.$elem = $(element);\r\n\t\tthis._dao = null;\r\n\t\tthis.init();\r\n\t};\r\n\r\n\tvar _sortByUrl = function (a, b) {\r\n\t\tif (a.url < b.url) {\r\n\t\t\treturn -1;\r\n\t\t} else if (a.url > b.url) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t};\r\n\r\n\tvar _sortByParentUrl = function (a, b) {\r\n\t\tif (a.parentUrl < b.parentUrl) {\r\n\t\t\treturn -1;\r\n\t\t} else if (a.parentUrl > b.parentUrl) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t};\r\n\t\r\n\tSPFileTree.prototype.getFiles = function(folderUrl, j) {\r\n\t\tvar files = [];\r\n\t\twhile (j < this.allFiles.length && this.allFiles[j].parentUrl === folderUrl) {\r\n\t\t\tfiles.push(this.allFiles[j]);\r\n\t\t\tj++;\r\n\t\t}\r\n\t\treturn { files: files, fileIndex: j };\r\n\t};\r\n\r\n\tSPFileTree.prototype._recursivePopulateChildFolders = function(parentFolder, i, j) {\r\n\t\tvar self = this;\r\n\t\tvar recursiveResult;\r\n\t\tvar getFilesResult;\r\n\t\twhile (i < self.allFolders.length) {\r\n\t\t\t// 1. next folder is a child folder\r\n\r\n\t\t\tif (self.allFolders[i].parentUrl === parentFolder.url) {\r\n\t\t\t\tgetFilesResult = self.getFiles(self.allFolders[i].url, j);\r\n\t\t\t\tj = getFilesResult.fileIndex;\r\n\t\t\t\r\n\t\t\t\trecursiveResult = self._recursivePopulateChildFolders(self.allFolders[i], i + 1, j);\r\n\t\t\t\trecursiveResult.folder.files = getFilesResult.files;\r\n\t\t\t\tparentFolder.folders.push(recursiveResult.folder);\r\n\t\t\t\ti = recursiveResult.index;\r\n\t\t\t\tj = recursiveResult.fileIndex;\r\n\t\t\t}\r\n\t\t\t// 2. next folder is a sibling\r\n\t\t\telse if (self.allFolders[i].parentUrl === parentFolder.parentUrl) {\r\n\t\t\t\t// Return the parent folder (sibling A) to be pushed on the parent's folder array, \r\n\t\t\t\t// Don't increment the index so sibling B will get processed as a child folder once it pops up the recursive chain\r\n\t\t\t\treturn { folder: parentFolder, index: i, fileIndex: j };\r\n\t\t\t}\r\n\t\t\t// 3. next folder pops back up the tree\r\n\t\t\telse if (self.allFolders[i].url.length < parentFolder.url.length) {\r\n\t\t\t\treturn { folder: parentFolder, index: i, fileIndex: j };\r\n\t\t\t} \r\n\t\t\telse {\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { folder: parentFolder, index: i, fileIndex: j };\r\n\t};\r\n\t\r\n\tSPFileTree.prototype.unflatten = function (items) {\r\n\t\t//sort them?\r\n\t\tvar self = this;\r\n\t\tvar allFolders = [];\r\n\t\tvar allFiles = [];\r\n\t\titems.forEach(function (item) {\r\n\t\t\tif (item.Folder && item.Folder.ServerRelativeUrl) {\r\n\t\t\t\tallFolders.push(new Folder(item));\r\n\t\t\t\t// allFolders[item.Folder.ServerRelativeUrl] = { item: item };\r\n\t\t\t} else if (item.File && item.File.ServerRelativeUrl) {\r\n\t\t\t\tallFiles.push(new File(item));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tallFolders.sort(_sortByUrl);\r\n\t\tallFiles.sort(_sortByParentUrl);\r\n\t\tself.allFolders = allFolders;\r\n\t\tself.allFiles = allFiles;\r\n\t\tvar rootFolder = {\r\n\t\t\tname: self.library.name,\r\n\t\t\turl: \"/sites/FoodServices/Style Library\",\r\n\t\t\tparentUrl: self.library.parentUrl,\r\n\t\t\tfolders: [],\r\n\t\t\tfiles: [],\r\n\t\t};\r\n\t\tvar recursiveResult = self._recursivePopulateChildFolders(rootFolder, 0, 0);\r\n\t\tconsole.log(recursiveResult);\r\n\t\treturn recursiveResult.folder;\r\n\t}\r\n\t\r\n\tSPFileTree.prototype.getListInfo = function() {\r\n\t\tvar self = this;\r\n\t\treturn this._dao.lists(this.library.name).info().then(function(info){\r\n\t\t\tself.library.parentUrl = info.ParentWebUrl;\r\n\t\t\tconsole.log(info);\r\n\t\t})\r\n\t};\r\n\t\r\n\tSPFileTree.prototype.getItems = function() {\r\n\t\treturn this._dao.lists(this.library.name).getItems(this.options.odata);\r\n\t};\r\n\tSPFileTree.prototype.init = function () {\r\n\t\tvar self = this;\r\n\t\tthis._dao = new sp.RestDao(this.options.webUrl);\r\n\t\tthis.getListInfo()\r\n\t\t\t.then(self.getItems.bind(self))\r\n            .then(self.unflatten.bind(self))\r\n\t\t\t.then(function (libraryFolder) {\r\n\t\t\t\tvar html = \"<ul class='treedata' style='display:none'>\";\r\n\t\t\t\thtml += Folder.prototype.toHtml.call(libraryFolder) + \"</ul>\";\r\n\t\t\t\tself.$elem.html(html).fancytree();\r\n\t\t\t});\r\n\t};\r\n\r\n\t$.fn[pluginName] = function (options) {\r\n\t\treturn this.each(function () {\r\n\t\t\treturn new SPFileTree(this, options);\r\n\t\t});\r\n\t};\r\n\r\n})(jQuery, SPScript);"]}