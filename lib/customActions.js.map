{"version":3,"sources":["../src/customActions.js"],"names":[],"mappings":"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","file":"customActions.js","sourcesContent":["var utils = require(\"./utils\");\r\nvar headers = require(\"./requestHeaders\");\r\n\r\nvar metadata = {\r\n\t__metadata: {\r\n\t\t\"type\": \"SP.UserCustomAction\"\r\n\t}\r\n};\r\n\r\nvar CustomActions = function (dao) {\r\n\tthis._dao = dao;\r\n\r\n\tthis.scopes = {\r\n\t\t\"Web\": {\r\n\t\t\tid: 3,\r\n\t\t\tname: \"Web\",\r\n\t\t\turl: \"/web/usercustomactions\"\r\n\t\t},\r\n\t\t\"Site\": {\r\n\t\t\tid: 2,\r\n\t\t\tname: \"Site\",\r\n\t\t\turl: \"/site/usercustomactions\"\r\n\t\t}\r\n\t};\r\n\tthis.scopes.getById = (id) => id === 2 ? this.scopes.Site : this.scopes.Web\r\n};\r\n\r\n// Get all Site and Web scoped custom actions.\r\n// If a name is passed, filter the result set\r\nCustomActions.prototype.get = function (name) {\r\n\r\n\t// first get the site scoped ones, then the web scoped ones\r\n\treturn this._dao.get(this.scopes.Site.url)\r\n\t\t.then(utils.validateODataV2)\r\n\t\t.then(siteCustomActions => {\r\n\t\t\treturn this._dao.get(this.scopes.Web.url)\r\n\t\t\t\t.then(utils.validateODataV2)\r\n\t\t\t\t//combine site scoped and web scoped into single array\r\n\t\t\t\t.then(webCustomActions => siteCustomActions.concat(webCustomActions));\r\n\t\t})\r\n\t\t.then(customActions => {\r\n\t\t\t// if a name was passed filter it otherwise return everything\r\n\t\t\tif (name) {\r\n\t\t\t\tvar matches = customActions.filter(a => a.Name === name);\r\n\t\t\t\tif (matches.length) {\r\n\t\t\t\t\treturn matches[0]\r\n\t\t\t\t}\r\n\t\t\t\tthrow new Error(\"Unable to find Custom Action with name: \" + name );\r\n\t\t\t}\r\n\t\t\telse return customActions;\r\n\t\t});\r\n};\r\n\r\n\r\nCustomActions.prototype._getUrl = function (name) {\r\n\treturn this.get(name)\r\n\t\t.then(a => `${this.scopes.getById(a.Scope).url}('${a.Id}')`);\r\n};\r\n\r\nCustomActions.prototype._getUrlAndDigest = function (name) {\r\n\tvar prep = {};\r\n\treturn this._getUrl(name)\r\n\t\t.then(url => {\r\n\t\t\tprep.url = url;\r\n\t\t\treturn this._dao.getRequestDigest()\r\n\t\t})\r\n\t\t.then(digest => {\r\n\t\t\tprep.digest = digest;\r\n\t\t\treturn prep;\r\n\t\t});\r\n};\r\n\r\nCustomActions.prototype.update = function (updates) {\r\n\tif (!updates || !updates.Name) throw new Error(\"You must at least pass a Custom Action 'Name'\");\r\n\r\n\treturn this._getUrlAndDigest(updates.Name)\r\n\t\t.then(prep => {\r\n\t\t\tupdates = Object.assign({}, metadata, updates);\r\n\t\t\tvar opts = {\r\n\t\t\t\theaders: headers.getUpdateHeaders(prep.digest)\r\n\t\t\t};\r\n\t\t\treturn this._dao.post(prep.url, updates, opts);\r\n\t\t})\r\n};\r\n\r\n\r\nCustomActions.prototype.remove = function (name) {\r\n\tif (!name) throw new Error(\"You must at least pass a Custom Action 'Name'\");\r\n\treturn this._getUrlAndDigest(name)\r\n\t\t.then(prep => {\r\n\t\t\tvar opts = {\r\n\t\t\t\theaders: headers.getDeleteHeaders(prep.digest)\r\n\t\t\t};\r\n\t\t\treturn this._dao.post(prep.url, {}, opts);\r\n\t\t});\r\n};\r\n\r\nCustomActions.prototype.add = function (customAction) {\r\n\tif (!customAction || !customAction.Name || !customAction.Location)\r\n\t\tthrow new Error(\"You must at least pass a Custom Action 'Name' and 'Location'\");\r\n\tcustomAction.Scope = customAction.Scope || \"Web\";\r\n\treturn this._dao.getRequestDigest()\r\n\t\t.then(digest => {\r\n\t\t\tcustomAction = Object.assign({}, metadata, customAction);\r\n\t\t\tvar scope = this.scopes[customAction.Scope]\r\n\t\t\tcustomAction.Scope = scope.id;\r\n\t\t\tvar opts = {\r\n\t\t\t\theaders: headers.getAddHeaders(digest)\r\n\t\t\t};\r\n\t\t\treturn this._dao.post(scope.url, customAction, opts);\r\n\t\t})\r\n};\r\n\r\n\r\nCustomActions.prototype.addScriptLink = function (name, url, scope = \"Web\") {\r\n\tvar customAction = {\r\n\t\tName: name,\r\n\t\tTitle: name,\r\n\t\tDescription: name,\r\n\t\tGroup: name,\r\n\t\tSequence: 100,\r\n\t\tLocation: \"ScriptLink\",\r\n\t\tScope: scope,\r\n\t\tScriptSrc: url\r\n\t};\r\n\treturn this.add(customAction);\r\n};\r\n\r\nCustomActions.prototype.addCSSLink = function (name, url, scope = \"Web\") {\r\n    var scriptBlockStr = `\r\n\t\t(function() {\r\n\t\t\tvar head = document.querySelector(\"head\");\r\n\t\t\tvar styleTag = document.createElement(\"style\");\r\n\t\t\tstyleTag.appendChild(document.createTextNode(\"body { opacity: 0 }\"));\r\n\t\t\t\r\n\t\t\tvar linkTag = document.createElement(\"link\");\r\n\t\t\tlinkTag.rel = \"stylesheet\";\tlinkTag.href = \"${url}\"; linkTag.type = \"text/css\";\r\n\t\t\tlinkTag.addEventListener(\"load\", function() {\r\n\t\t\t\thead.removeChild(styleTag);\r\n\t\t\t});\r\n\r\n\t\t\thead.appendChild(styleTag);\r\n\t\t\thead.appendChild(linkTag);\r\n\t\t})();`\r\n\r\n\tvar customAction = {\r\n\t\tName: name,\r\n\t\tTitle: name,\r\n\t\tDescription: name,\r\n\t\tGroup: name,\r\n\t\tSequence: 100,\r\n\t\tScope: scope,\r\n\t\tLocation: \"ScriptLink\",\r\n\t\tScriptBlock: scriptBlockStr\r\n\t};\r\n\r\n\treturn this.add(customAction);\r\n};\r\nCustomActions.metadata = metadata;\r\n\r\nmodule.exports = CustomActions;"]}