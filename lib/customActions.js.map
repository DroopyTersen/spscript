{"version":3,"sources":["../src/customActions.js"],"names":[],"mappings":"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","file":"customActions.js","sourcesContent":["var utils = require(\"./utils\");\r\nvar headers = require(\"./requestHeaders\");\r\n\r\n// MSDN Info\r\n// https://msdn.microsoft.com/en-us/library/office/dn531432.aspx#bk_UserCustomActionCollection\r\n\r\n\r\n\r\nvar metadata = {\r\n\t__metadata: {\r\n\t\t\"type\": \"SP.UserCustomAction\"\r\n\t}\r\n};\r\n\r\nvar CustomActions = function(web) {\r\n\tthis.web = web;\r\n\tthis.baseUrl = \"/web/userCustomActions\";\r\n};\r\n\r\nCustomActions.prototype.get = function(name) {\r\n\treturn this.web._dao.get(this.baseUrl)\r\n\t\t.then(utils.validateODataV2)\r\n\t\t.then(customActions => {\r\n\t\t\tif (name) return customActions.find(a => a.Name === name);\r\n\t\t\telse return customActions;\r\n\t\t});\r\n};\r\n\r\nCustomActions.prototype._getUrl = function(name) {\r\n\treturn this.get(name).then(a => {\r\n\t\tvar url = `${this.baseUrl}('${a.Id}')`\r\n\t\treturn url;\r\n\t});\r\n};\r\n\r\nCustomActions.prototype._getUrlAndDigest = function(name) {\r\n\tvar prep = {};\r\n\treturn this._getUrl(name)\r\n\t\t.then(url => {\r\n\t\t\tprep.url = url;\r\n\t\t\treturn this.web.getRequestDigest()\r\n\t\t})\r\n\t\t.then(digest => {\r\n\t\t\tprep.digest = digest;\r\n\t\t\treturn prep;\r\n\t\t});\r\n};\r\n\r\nCustomActions.prototype.update = function(updates) {\r\n\tif (!updates || !updates.Name) throw new Error(\"You must at least pass a Custom Action 'Name'\");\r\n\treturn this._getUrlAndDigest(updates.Name)\r\n\t\t.then(prep => {\r\n\t\t\tupdates = Object.assign({}, metadata, updates);\r\n\t\t\tvar opts = {\r\n\t\t\t\theaders: headers.getUpdateHeaders(prep.digest)\r\n\t\t\t};\r\n\t\t\treturn this.web._dao.post(prep.url, updates, opts);\r\n\t\t})\r\n};\r\n\r\n// 1. Get request digest to authorize request\r\n// 2. Get all the custom actions\r\n// 3. Filter to get the custom actions with the specified name\r\n// 4. Perform a DELETE request on each of the matching custom actions\r\n// 5. Wait for all the DELETE's to succeed before resolving the promise\r\nCustomActions.prototype.remove = function(name) {\r\n\tvar digest = null;\r\n\treturn this.web.getRequestDigest()\r\n\t\t.then(d => digest = d)\r\n\t\t.then(() => this.get())\r\n\t\t.then(all => all.filter(a => a.Name === name))\r\n\t\t.then(matches => Promise.all(matches.map(a => this._remove(a.Id, digest))))\r\n};\r\n\r\nCustomActions.prototype._remove = function(id, digest) {\r\n\tvar url = `${this.baseUrl}('${id}')`;\r\n\tvar opts = {\r\n\t\theaders: headers.getDeleteHeaders(digest)\r\n\t};\r\n\treturn this.web._dao.post(url, {}, opts);\r\n};\r\n\r\nCustomActions.prototype.add = function(customAction) {\r\n\tif (!customAction || !customAction.Name || !customAction.Location) \r\n\t\tthrow new Error(\"You must at least pass a Custom Action 'Name' and 'Location'\");\r\n\treturn this.web.getRequestDigest()\r\n\t\t.then(digest => {\r\n\t\t\tcustomAction = Object.assign({}, metadata, customAction);\r\n\t\t\tvar opts = {\r\n\t\t\t\theaders: headers.getAddHeaders(digest)\r\n\t\t\t};\r\n\t\t\treturn this.web._dao.post(this.baseUrl, customAction, opts);\r\n\t\t})\r\n};\r\nCustomActions.metadata = metadata;\r\nmodule.exports = CustomActions;"]}