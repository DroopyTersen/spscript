{"version":3,"sources":["../src/customActions.js"],"names":["utils","require","headers","metadata","__metadata","CustomActions","dao","_dao","scopes","id","name","url","getById","Site","Web","prototype","get","then","validateODataV2","siteCustomActions","concat","webCustomActions","customActions","find","a","Name","_getUrl","Scope","Id","_getUrlAndDigest","prep","getRequestDigest","digest","update","updates","Error","opts","getUpdateHeaders","post","remove","getDeleteHeaders","add","customAction","Location","scope","getAddHeaders","addScriptLink","Title","Description","Group","Sequence","ScriptSrc","addCSSLink","scriptBlockStr","ScriptBlock","module","exports"],"mappings":"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","file":"customActions.js","sourcesContent":["var utils = require(\"./utils\");\r\nvar headers = require(\"./requestHeaders\");\r\n\r\nvar metadata = {\r\n\t__metadata: {\r\n\t\t\"type\": \"SP.UserCustomAction\"\r\n\t}\r\n};\r\n\r\nvar CustomActions = function (dao) {\r\n\tthis._dao = dao;\r\n\r\n\tthis.scopes = {\r\n\t\t\"Web\": {\r\n\t\t\tid: 3,\r\n\t\t\tname: \"Web\",\r\n\t\t\turl: \"/web/usercustomactions\"\r\n\t\t},\r\n\t\t\"Site\": {\r\n\t\t\tid: 2,\r\n\t\t\tname: \"Site\",\r\n\t\t\turl: \"/site/usercustomactions\"\r\n\t\t}\r\n\t};\r\n\tthis.scopes.getById = (id) => id === 2 ? this.scopes.Site : this.scopes.Web\r\n};\r\n\r\n// Get all Site and Web scoped custom actions.\r\n// If a name is passed, filter the result set\r\nCustomActions.prototype.get = function (name) {\r\n\r\n\t// first get the site scoped ones, then the web scoped ones\r\n\treturn this._dao.get(this.scopes.Site.url)\r\n\t\t.then(utils.validateODataV2)\r\n\t\t.then(siteCustomActions => {\r\n\t\t\treturn this._dao.get(this.scopes.Web.url)\r\n\t\t\t\t.then(utils.validateODataV2)\r\n\t\t\t\t//combine site scoped and web scoped into single array\r\n\t\t\t\t.then(webCustomActions => siteCustomActions.concat(webCustomActions));\r\n\t\t})\r\n\t\t.then(customActions => {\r\n\t\t\t// if a name was passed filter it otherwise return everything\r\n\t\t\tif (name) return customActions.find(a => a.Name === name);\r\n\t\t\telse return customActions;\r\n\t\t});\r\n};\r\n\r\n\r\nCustomActions.prototype._getUrl = function (name) {\r\n\treturn this.get(name)\r\n\t\t.then(a => `${this.scopes.getById(a.Scope).url}('${a.Id}')`);\r\n};\r\n\r\nCustomActions.prototype._getUrlAndDigest = function (name) {\r\n\tvar prep = {};\r\n\treturn this._getUrl(name)\r\n\t\t.then(url => {\r\n\t\t\tprep.url = url;\r\n\t\t\treturn this._dao.getRequestDigest()\r\n\t\t})\r\n\t\t.then(digest => {\r\n\t\t\tprep.digest = digest;\r\n\t\t\treturn prep;\r\n\t\t});\r\n};\r\n\r\nCustomActions.prototype.update = function (updates) {\r\n\tif (!updates || !updates.Name) throw new Error(\"You must at least pass a Custom Action 'Name'\");\r\n\r\n\treturn this._getUrlAndDigest(updates.Name)\r\n\t\t.then(prep => {\r\n\t\t\tupdates = Object.assign({}, metadata, updates);\r\n\t\t\tvar opts = {\r\n\t\t\t\theaders: headers.getUpdateHeaders(prep.digest)\r\n\t\t\t};\r\n\t\t\treturn this._dao.post(prep.url, updates, opts);\r\n\t\t})\r\n};\r\n\r\n\r\nCustomActions.prototype.remove = function (name) {\r\n\tif (!name) throw new Error(\"You must at least pass a Custom Action 'Name'\");\r\n\treturn this._getUrlAndDigest(name)\r\n\t\t.then(prep => {\r\n\t\t\tvar opts = {\r\n\t\t\t\theaders: headers.getDeleteHeaders(prep.digest)\r\n\t\t\t};\r\n\t\t\treturn this._dao.post(prep.url, {}, opts);\r\n\t\t});\r\n};\r\n\r\nCustomActions.prototype.add = function (customAction) {\r\n\tif (!customAction || !customAction.Name || !customAction.Location)\r\n\t\tthrow new Error(\"You must at least pass a Custom Action 'Name' and 'Location'\");\r\n\tcustomAction.Scope = customAction.Scope || \"Web\";\r\n\treturn this._dao.getRequestDigest()\r\n\t\t.then(digest => {\r\n\t\t\tcustomAction = Object.assign({}, metadata, customAction);\r\n\t\t\tvar scope = this.scopes[customAction.Scope]\r\n\t\t\tcustomAction.Scope = scope.id;\r\n\t\t\tvar opts = {\r\n\t\t\t\theaders: headers.getAddHeaders(digest)\r\n\t\t\t};\r\n\t\t\treturn this._dao.post(scope.url, customAction, opts);\r\n\t\t})\r\n};\r\n\r\n\r\nCustomActions.prototype.addScriptLink = function (name, url, scope = \"Web\") {\r\n\tvar customAction = {\r\n\t\tName: name,\r\n\t\tTitle: name,\r\n\t\tDescription: name,\r\n\t\tGroup: name,\r\n\t\tSequence: 100,\r\n\t\tLocation: \"ScriptLink\",\r\n\t\tScope: scope,\r\n\t\tScriptSrc: url\r\n\t};\r\n\treturn this.add(customAction);\r\n};\r\n\r\nCustomActions.prototype.addCSSLink = function (name, url, scope = \"Web\") {\r\n    var scriptBlockStr = `\r\n\t\t(function() {\r\n\t\t\tvar head = document.querySelector(\"head\");\r\n\t\t\tvar styleTag = document.createElement(\"style\");\r\n\t\t\tstyleTag.appendChild(document.createTextNode(\"body { opacity: 0 }\"));\r\n\t\t\t\r\n\t\t\tvar linkTag = document.createElement(\"link\");\r\n\t\t\tlinkTag.rel = \"stylesheet\";\tlinkTag.href = \"${url}\"; linkTag.type = \"text/css\";\r\n\t\t\tlinkTag.addEventListener(\"load\", function() {\r\n\t\t\t\thead.removeChild(styleTag);\r\n\t\t\t});\r\n\r\n\t\t\thead.appendChild(styleTag);\r\n\t\t\thead.appendChild(linkTag);\r\n\t\t})();`\r\n\r\n\tvar customAction = {\r\n\t\tName: name,\r\n\t\tTitle: name,\r\n\t\tDescription: name,\r\n\t\tGroup: name,\r\n\t\tSequence: 100,\r\n\t\tScope: scope,\r\n\t\tLocation: \"ScriptLink\",\r\n\t\tScriptBlock: scriptBlockStr\r\n\t};\r\n\r\n\treturn this.add(customAction);\r\n};\r\nCustomActions.metadata = metadata;\r\n\r\nmodule.exports = CustomActions;"]}