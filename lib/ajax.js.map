{"version":3,"sources":["../src/ajax.js"],"names":["defaults","method","async","type","data","undefined","validMethods","errorHandlers","validateOptions","options","url","indexOf","setHeaders","xhr","headersObj","Object","keys","forEach","setRequestHeader","key","ajax","opts","Promise","reject","Error","XMLHttpRequest","open","headers","responseType","resolve","onreadystatechange","readyState","status","response","error","statusCode","body","fn","send","addErrorHandler","push","setDefaults","module","exports"],"mappings":";;;;AAAA;;;;AAIA,IAAIA,WAAW;AACdC,SAAQ,KADM;AAEdC,QAAO,IAFO;AAGdC,OAAM,MAHQ,EAGA;AACdC,OAAMC;AAJQ,CAAf;;AAOA,IAAIC,eAAe,CAClB,KADkB,EAElB,MAFkB,EAGlB,KAHkB,EAIlB,MAJkB,EAKlB,QALkB,EAMlB,OANkB,CAAnB;;AASA,IAAIC,gBAAgB,EAApB;;AAEA,IAAIC,kBAAkB,SAAlBA,eAAkB,CAASC,OAAT,EAAkB;AACvC,KAAI,CAACA,OAAD,IAAY,CAACA,QAAQC,GAArB,IAA4BJ,aAAaK,OAAb,CAAqBF,QAAQR,MAA7B,IAAuC,CAAvE,EACC,OAAO,KAAP,CADD,KAEK,OAAO,IAAP;AACL,CAJD;;AAMA,IAAIW,aAAa,SAAbA,UAAa,CAASC,GAAT,EAAcC,UAAd,EAA0B;AAC1C,KAAIA,UAAJ,EAAgB;AACfC,SAAOC,IAAP,CAAYF,UAAZ,EAAwBG,OAAxB,CAAgC,eAAO;AACtCJ,OAAIK,gBAAJ,CAAqBC,GAArB,EAA0BL,WAAWK,GAAX,CAA1B;AACA,GAFD;AAGA;AACD,CAND;;AAQA;;;;;;;;;;;;;;;;;AAiBA,IAAIC,OAAO,SAAPA,IAAO,CAASX,OAAT,EAAkB;AAC5B,KAAIY,OAAO,SAAc,EAAd,EAAkBrB,QAAlB,EAA4BS,OAA5B,CAAX;AACA,KAAI,CAACD,gBAAgBC,OAAhB,CAAL,EACC,OAAOa,QAAQC,MAAR,CAAe,IAAIC,KAAJ,CAAU,wCAAV,CAAf,CAAP;;AAED,KAAIX,MAAM,IAAIY,cAAJ,EAAV;AACA,KAAIZ,OAAO,IAAX,EACC,OAAOS,QAAQC,MAAR,CAAe,IAAIC,KAAJ,CAAU,qDAAV,CAAf,CAAP;;AAGDX,KAAIa,IAAJ,CAASL,KAAKpB,MAAd,EAAsBoB,KAAKX,GAA3B,EAAgCW,KAAKnB,KAArC;AACAU,YAAWC,GAAX,EAAgBQ,KAAKM,OAArB;AACAd,KAAIe,YAAJ,GAAmBP,KAAKlB,IAAxB;;AAEA,QAAO,IAAImB,OAAJ,CAAY,UAACO,OAAD,EAAUN,MAAV,EAAqB;AACvCV,MAAIiB,kBAAJ,GAAyB,YAAW;AACnC;AACA,OAAIjB,IAAIkB,UAAJ,KAAmB,CAAvB,EAA0B;AACzB;AACA,QAAIlB,IAAImB,MAAJ,GAAa,GAAb,IAAoBnB,IAAImB,MAAJ,IAAc,GAAtC,EAA2C;AAC1CH,aAAQhB,IAAIoB,QAAZ;AACA,KAFD,MAEO;AACN,SAAIC,QAAQ,IAAIV,KAAJ,CAAU,yCAAyCX,IAAImB,MAAvD,CAAZ;AACAE,WAAMC,UAAN,GAAmBtB,IAAImB,MAAvB;AACAE,WAAME,IAAN,GAAavB,IAAIoB,QAAjB;AACA1B,mBAAcU,OAAd,CAAsB;AAAA,aAAMoB,GAAGH,KAAH,EAAUrB,GAAV,CAAN;AAAA,MAAtB;AACAU,YAAOW,KAAP;AACA;AACD;AACD,GAdD;;AAgBArB,MAAIyB,IAAJ,CAASjB,KAAKjB,IAAd;AACA,EAlBM,CAAP;AAmBA,CAjCD;;AAmCAgB,KAAKmB,eAAL,GAAuB,UAACF,EAAD;AAAA,QAAQ9B,cAAciC,IAAd,CAAmBH,EAAnB,CAAR;AAAA,CAAvB;AACAjB,KAAKqB,WAAL,GAAmB,UAAChC,OAAD;AAAA,QAAa,SAAcT,QAAd,EAAwBS,OAAxB,CAAb;AAAA,CAAnB;;AAEAiC,OAAOC,OAAP,GAAiBvB,IAAjB","file":"ajax.js","sourcesContent":["/**\r\n* @namespace SPScript.ajax\r\n*/\r\n\r\nvar defaults = {\r\n\tmethod: \"GET\",\r\n\tasync: true,\r\n\ttype: \"json\", //XMLHttpRequest.responseType\r\n\tdata: undefined\r\n};\r\n\r\nvar validMethods = [\r\n\t\"GET\",\r\n\t\"POST\",\r\n\t\"PUT\",\r\n\t\"HEAD\",\r\n\t\"DELETE\",\r\n\t\"PATCH\"\r\n];\r\n\r\nvar errorHandlers = [];\r\n\r\nvar validateOptions = function(options) {\r\n\tif (!options || !options.url || validMethods.indexOf(options.method) < 0)\r\n\t\treturn false\r\n\telse return true\r\n};\r\n\r\nvar setHeaders = function(xhr, headersObj) {\r\n\tif (headersObj) {\r\n\t\tObject.keys(headersObj).forEach(key => {\r\n\t\t\txhr.setRequestHeader(key, headersObj[key]);\r\n\t\t})\r\n\t}\r\n};\r\n\r\n/**\r\n * Performs and AJAX request based on options you pass you. Your options must at least have a url.\r\n * @param {object} options - Request options like { url, headers, method };\r\n * @returns {Promise} - A ES6 Promise that resolves or rejects when the request comes back\r\n * @function ajax\r\n * @memberof SPScript.ajax\r\n * @example\r\n * var ajaxOptions = { \r\n *    url: '/_api/web/contentTypes', \r\n *    method: \"GET\", \r\n *    headers: { Accept: \"application/json;odata=verbose\" } \r\n * };\r\n * SPScript.utils.ajax(ajaxOptions)\r\n *\t\t.then(SPScript.utils.parseJSON)\r\n *\t\t.then(function(data){ console.log(data.d.results) })\r\n *\t\t.catch(function(error) { console.log(error)})\r\n */\r\nvar ajax = function(options) {\r\n\tvar opts = Object.assign({}, defaults, options);\r\n\tif (!validateOptions(options))\r\n\t\treturn Promise.reject(new Error(\"Invalid options passed into ajax call.\"));\r\n\r\n\tvar xhr = new XMLHttpRequest();\r\n\tif (xhr == null) \r\n\t\treturn Promise.reject(new Error(\"Your browser doesn't support XMLHttpRequest (ajax).\"));\r\n\r\n\r\n\txhr.open(opts.method, opts.url, opts.async);\r\n\tsetHeaders(xhr, opts.headers);\r\n\txhr.responseType = opts.type;\r\n\r\n\treturn new Promise((resolve, reject) => {\r\n\t\txhr.onreadystatechange = function() {\r\n\t\t\t//completed\r\n\t\t\tif (xhr.readyState === 4) {\r\n\t\t\t\t// SUCCESS\r\n\t\t\t\tif (xhr.status < 400 && xhr.status >= 100) {\r\n\t\t\t\t\tresolve(xhr.response);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar error = new Error(\"AJAX Request Error: Response Code = \" + xhr.status);\r\n\t\t\t\t\terror.statusCode = xhr.status;\r\n\t\t\t\t\terror.body = xhr.response;\r\n\t\t\t\t\terrorHandlers.forEach(fn => fn(error, xhr));\r\n\t\t\t\t\treject(error);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\txhr.send(opts.data);\r\n\t})\r\n};\r\n\r\najax.addErrorHandler = (fn) => errorHandlers.push(fn);\r\najax.setDefaults = (options) => Object.assign(defaults, options);\r\n\r\nmodule.exports = ajax;"]}