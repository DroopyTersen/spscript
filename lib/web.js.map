{"version":3,"sources":["../src/web.js"],"names":[],"mappings":";;AAAA,IAAI,QAAQ,QAAQ,SAAR,CAAZ;AACA,IAAI,cAAc,QAAQ,eAAR,CAAlB;AACA,IAAI,UAAU,QAAQ,kBAAR,CAAd;AACA,IAAI,SAAS,QAAQ,cAAR,EAAwB,MAArC;;;;;;;;;;;;AAYA,IAAI,MAAM,SAAN,GAAM,CAAS,GAAT,EAAc;AACvB,MAAK,IAAL,GAAY,GAAZ;AACA,MAAK,OAAL,GAAe,MAAf;AACA,MAAK,WAAL,GAAmB,IAAI,WAAJ,CAAgB,KAAK,OAArB,EAA8B,KAAK,IAAnC,CAAnB;AACA,CAJD;;;;;;;;AAYA,IAAI,SAAJ,CAAc,IAAd,GAAqB,YAAW;AAC/B,QAAO,KAAK,IAAL,CACL,GADK,CACD,KAAK,OADJ,EAEL,IAFK,CAEA,MAAM,eAFN,CAAP;AAGA,CAJD;;;;;;;;AAYA,IAAI,SAAJ,CAAc,QAAd,GAAyB,YAAW;AACnC,QAAO,KAAK,IAAL,CACL,GADK,CACD,KAAK,OAAL,GAAe,WADd,EAEL,IAFK,CAEA,MAAM,eAFN,CAAP;AAGA,CAJD;;;;;;;;AAYA,IAAI,SAAJ,CAAc,gBAAd,GAAiC,YAAW;AAC3C,QAAO,KAAK,IAAL,CAAU,IAAV,CAAe,cAAf,EAA+B,EAA/B,EACL,IADK,CACA;AAAA,SAAQ,KAAK,CAAL,CAAO,wBAAP,CAAgC,eAAxC;AAAA,EADA,CAAP;AAEA,CAHD;;;;;;;;;;AAaA,IAAI,SAAJ,CAAc,SAAd,GAA0B,UAAS,iBAAT,EAA4B;;AAErD,KAAI,kBAAkB,MAAlB,CAAyB,CAAzB,MAAgC,GAApC,EAAyC;AACxC,sBAAoB,kBAAkB,MAAlB,CAAyB,CAAzB,CAApB;AACA;AACD,KAAI,MAAM,wCAAwC,iBAAxC,GAA4D,0BAAtE;;AAEA,QAAO,KAAK,IAAL,CAAU,GAAV,CAAc,GAAd,EAAmB,IAAnB,CAAwB,MAAM,eAA9B,EACL,IADK,CACA,oBAAY;AACjB,MAAI,SAAS,IAAI,MAAJ,CAAW,QAAX,CAAb;AACA,SAAO,gBAAP,CAAwB,QAAxB;AACA,SAAO,MAAP;AACA,EALK,CAAP;AAMA,CAbD;;AAeA,IAAI,SAAJ,CAAc,UAAd,GAA2B,UAAS,SAAT,EAAoB,WAApB,EAAiC,IAAjC,EAAuC,MAAvC,EAA+C;AAAA;;AACzE,KAAI,MAAJ,EAAY,OAAO,KAAK,WAAL,CAAiB,SAAjB,EAA4B,IAA5B,EAAkC,YAAlC,EAAgD,MAAhD,CAAP;AACZ,QAAO,KAAK,gBAAL,GAAwB,IAAxB,CAA6B;AAAA,SAAU,MAAK,WAAL,CAAiB,SAAjB,EAA4B,WAA5B,EAAyC,IAAzC,EAA+C,MAA/C,CAAV;AAAA,EAA7B,CAAP;AACA,CAHD;;AAKA,IAAI,SAAJ,CAAc,WAAd,GAA4B,UAAS,SAAT,EAAoB,WAApB,EAAiC,IAAjC,EAAuC,MAAvC,EAA+C;AAC1E,KAAI,OAAO,IAAX;AACA,QAAO,IAAI,OAAJ,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;;AAE5C,MAAI,uBAAuB,IAA3B,EAAiC;AAChC,UAAO,QAAQ,YAAY,IAA3B;AACA,OAAI,SAAS,IAAI,UAAJ,EAAb;AACA,UAAO,MAAP,GAAgB,UAAS,CAAT,EAAY;AAC3B,QAAI,WAAW,EAAE,MAAF,CAAS,MAAxB;;;;;;AAMA,QAAI,YAAY,wCAAwC,SAAxC,GAAoD,oBAApD,GAA2E,IAA3E,GAAkF,mBAAlG;AACA,QAAI,UAAU;AACb,cAAS,QAAQ,oBAAR,CAA6B,MAA7B;AADI,KAAd;AAGA,YAAQ,OAAR,CAAgB,gBAAhB,IAAoC,SAAS,MAA7C;AACA,SAAK,IAAL,CAAU,IAAV,CAAe,SAAf,EAA0B,QAA1B,EAAoC,OAApC,EAA6C,IAA7C,CAAkD,OAAlD;AACA,IAbD;AAcA,UAAO,iBAAP,CAAyB,WAAzB;AACA;AACD,EArBM,CAAP;;;;;;;AA4BA,CA9BD;;;;;;;;;;AAwCA,IAAI,SAAJ,CAAc,OAAd,GAAwB,UAAS,GAAT,EAAc;AACrC,KAAI,4CAA0C,GAA1C,OAAJ;AACA,QAAO,KAAK,IAAL,CAAU,GAAV,CAAc,GAAd,EAAmB,IAAnB,CAAwB,MAAM,eAA9B,CAAP;AACA,CAHD;;;;;;;;;;;;AAeA,IAAI,SAAJ,CAAc,QAAd,GAAyB,UAAS,SAAT,EAAoB,cAApB,EAAoC,MAApC,EAA4C;AAAA;;AACpE,KAAI,MAAJ,EAAY,OAAO,KAAK,SAAL,CAAe,SAAf,EAA0B,cAA1B,EAA0C,MAA1C,CAAP;;AAEZ,QAAO,KAAK,gBAAL,GAAwB,IAAxB,CAA6B;AAAA,SAAiB,OAAK,SAAL,CAAe,SAAf,EAA0B,cAA1B,EAA0C,aAA1C,CAAjB;AAAA,EAA7B,CAAP;AACA,CAJD;;AAMA,IAAI,SAAJ,CAAc,SAAd,GAA0B,UAAS,SAAT,EAAoB,cAApB,EAAoC,MAApC,EAA4C;AACrE,KAAI,4CAA0C,SAA1C,6BAA2E,cAA3E,uBAAJ;AACA,KAAI,UAAU;AACb,WAAS,QAAQ,aAAR,CAAsB,MAAtB;AADI,EAAd;AAGA,QAAO,KAAK,IAAL,CAAU,IAAV,CAAe,GAAf,EAAoB,EAApB,EAAwB,OAAxB,CAAP;AACA,CAND;;;;;;;;;;AAgBA,IAAI,SAAJ,CAAc,UAAd,GAA2B,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAAA;;AACpD,KAAI,MAAJ,EAAY,OAAO,KAAK,WAAL,CAAiB,OAAjB,EAA0B,MAA1B,CAAP;;AAEZ,QAAO,KAAK,gBAAL,GAAwB,IAAxB,CAA6B;AAAA,SAAiB,OAAK,WAAL,CAAiB,OAAjB,EAA0B,aAA1B,CAAjB;AAAA,EAA7B,CAAP;AACA,CAJD;;AAMA,IAAI,SAAJ,CAAc,WAAd,GAA4B,UAAS,SAAT,EAAoB,aAApB,EAAmC;AAC9D,KAAI,MAAM,kDAAkD,SAAlD,GAA8D,GAAxE;AACA,KAAI,UAAU;AACb,WAAS,QAAQ,gBAAR,CAAyB,aAAzB;AADI,EAAd;AAGA,QAAO,KAAK,IAAL,CAAU,IAAV,CAAe,GAAf,EAAoB,EAApB,EAAwB,OAAxB,CAAP;AACA,CAND;;;;;;;;;;AAgBA,IAAI,SAAJ,CAAc,OAAd,GAAwB,UAAS,KAAT,EAAgB;AACvC,KAAI,MAAM,KAAK,OAAL,GAAe,yBAAf,GAA2C,KAA3C,GAAmD,IAA7D;AACA,QAAO,KAAK,IAAL,CAAU,GAAV,CAAc,GAAd,EAAmB,IAAnB,CAAwB,MAAM,eAA9B,CAAP;AACA,CAHD;;AAKA,OAAO,OAAP,GAAiB,GAAjB","file":"web.js","sourcesContent":["var utils = require(\"./utils\");\r\nvar Permissions = require(\"./permissions\");\r\nvar headers = require(\"./requestHeaders\");\r\nvar Folder = require(\"./filesystem\").Folder;\r\n\r\n/**\r\n * Represents a SharePoint site. You shouldn't ever be new'ing this class up up yourself, instead you'll get it from your dao as shown in first example.\r\n * @class\r\n * @param {IBaseDao} dao - Data access object used to make requests.\r\n * @property {Permissions} permissions - allows checking security information of the Web\r\n * @property {string} baseUrl - API relative url (value = \"/web\")\r\n * @example <caption>You access this Web class using the 'web' property of the dao</caption>\r\n * var dao = new SPScript.RestDao(_spPageContextInfo.webAbsoluteUrl);\r\n * dao.web.info().then(function(info) { console.log(info) });\r\n */\r\nvar Web = function(dao) {\r\n\tthis._dao = dao;\r\n\tthis.baseUrl = \"/web\";\r\n\tthis.permissions = new Permissions(this.baseUrl, this._dao);\r\n};\r\n\r\n/**\r\n * Retrieves basic information about the site\r\n * @returns {Promise<SP.Web>} - A Promise that resolves to an object containing non-deferred properties of SP.Web (https://msdn.microsoft.com/en-us/library/office/jj244873.aspx)\r\n * @example\r\n * dao.web.info().then(function(info) { console.log(info) });\r\n */\r\nWeb.prototype.info = function() {\r\n\treturn this._dao\r\n\t\t.get(this.baseUrl)\r\n\t\t.then(utils.validateODataV2);\r\n};\r\n\r\n/**\r\n * Retrieves all of the subsites\r\n * @returns {Promise<SP.Web[]>} - A Promise that resolves to an array of subsite object, each loaded with all non-deferred properties\r\n * @example\r\n *  dao.web.subsites().then(function(sites) { console.log(sites) });\r\n */\r\nWeb.prototype.subsites = function() {\r\n\treturn this._dao\r\n\t\t.get(this.baseUrl + \"/webinfos\")\r\n\t\t.then(utils.validateODataV2);\r\n};\r\n\r\n/**\r\n * Retrieves a token needed to authorize any updates\r\n * @return {string} - A Promise that resolves to a the token that needs to added to the \"X-RequestDigest\" request header\r\n * @example\r\n *  dao.web.getRequestDigest().then(function(digest) { console.log(digest) });\r\n */\r\nWeb.prototype.getRequestDigest = function() {\r\n\treturn this._dao.post('/contextinfo', {})\r\n\t\t.then(data => data.d.GetContextWebInformation.FormDigestValue);\r\n};\r\n\r\n/**\r\n * Retrieves a folder\r\n * @param {string} serverRelativeUrl - The server relative url of the folder\r\n * @returns {Promise<Folder>} - A Promise that resolves to a folder object contain a files and folders arrays\r\n * @example\r\n *  dao.web.getFolder(\"/sites/mysite/Shared Documents\")\r\n *\t\t\t.then(function(folder) { console.log(folder) });\r\n */\r\nWeb.prototype.getFolder = function(serverRelativeUrl) {\r\n\t//remove leading slash\r\n\tif (serverRelativeUrl.charAt(0) === \"/\") {\r\n\t\tserverRelativeUrl = serverRelativeUrl.substr(1);\r\n\t}\r\n\tvar url = \"/web/GetFolderByServerRelativeUrl('\" + serverRelativeUrl + \"')?$expand=Folders,Files\";\r\n\r\n\treturn this._dao.get(url).then(utils.validateODataV2)\r\n\t\t.then(spFolder => {\r\n\t\t\tvar folder = new Folder(spFolder);\r\n\t\t\tfolder.populateChildren(spFolder);\r\n\t\t\treturn folder;\r\n\t\t});\r\n};\r\n\r\nWeb.prototype.uploadFile = function(folderUrl, fileContent, name, digest) {\r\n\tif (digest) return this._uploadFile(folderUrl, name, base64Binary, digest);\r\n\treturn this.getRequestDigest().then(digest => this._uploadFile(folderUrl, fileContent, name, digest));\r\n}\r\n\r\nWeb.prototype._uploadFile = function(folderUrl, fileContent, name, digest) {\r\n\tvar self = this;\r\n\treturn new Promise(function(resolve, reject) {\r\n\t\t// If its a 'File' it came from a File input or Drag and drop\r\n\t\tif (fileContent instanceof File) {\r\n\t\t\tname = name || fileContent.name;\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\treader.onload = function(e) {\r\n\t\t\t\tvar fileData = e.target.result\r\n\t\t\t\t// var fileData = \"\";\r\n\t\t\t\t// var byteArray = new Uint8Array(e.target.result)\r\n\t\t\t\t// for (var i = 0; i < byteArray.byteLength; i++) {\r\n\t\t\t\t// \tfileData += String.fromCharCode(byteArray[i])\r\n\t\t\t\t// }\r\n\t\t\t\tvar uploadUrl = \"/web/GetFolderByServerRelativeUrl('\" + folderUrl + \"')/Files/Add(url='\" + name + \"',overwrite=true)\";\r\n\t\t\t\tvar options = {\r\n\t\t\t\t\theaders: headers.getFilestreamHeaders(digest)\r\n\t\t\t\t};\r\n\t\t\t\toptions.headers[\"Content-Length\"] = fileData.length;\r\n\t\t\t\tself._dao.post(uploadUrl, fileData, options).then(resolve);\r\n\t\t\t};\r\n\t\t\treader.readAsArrayBuffer(fileContent);\r\n\t\t}\r\n\t})\r\n\r\n\t// var options = {\r\n\t// \t\tbinaryStringRequestBody: true,\r\n\t// \t\tstate: \"Update\"\r\n\t// };\r\n\t// return this.post(uploadUrl, base64Binary, options);\r\n};\r\n\r\n/**\r\n * Retrieves a file object\r\n * @param {string} url - The server relative url of the file\r\n * @returns {Promise<File>} - A Promise that resolves to a file object\r\n * @example\r\n *  dao.web.getFile(\"/sites/mysite/Shared Documents/myfile.docx\")\r\n *\t\t\t.then(function(file) { console.log(file) });\r\n */\r\nWeb.prototype.getFile = function(url) {\r\n\tvar url = `/web/getfilebyserverrelativeurl('${url}')`\r\n\treturn this._dao.get(url).then(utils.validateODataV2);\r\n};\r\n\r\n/**\r\n * Copies a file\r\n * @param {string} sourceUrl - The server relative url of the file you want to copy\r\n * @param {string} destinationUrl - The server relative url of the destination\r\n * @param {string} [[requestDigest]] - The request digest token used to authorize the request. One will be automatically retrieved if not passed.\r\n * @example\r\n * var sourceFile = \"/sites/mysite/Shared Documents/myfile.docx\";\r\n * var destination = \"/sites/mysite/Restricted Docs/myFile.docx\";\r\n * dao.web.copyFile(sourceFile, destination).then(function() { console.log(\"Success\") });\r\n */\r\nWeb.prototype.copyFile = function(sourceUrl, destinationUrl, digest) {\r\n\tif (digest) return this._copyFile(sourceUrl, destinationUrl, digest);\r\n\r\n\treturn this.getRequestDigest().then(requestDigest => this._copyFile(sourceUrl, destinationUrl, requestDigest));\r\n};\r\n\r\nWeb.prototype._copyFile = function(sourceUrl, destinationUrl, digest) {\r\n\tvar url = `/web/getfilebyserverrelativeurl('${sourceUrl}')/CopyTo(strnewurl='${destinationUrl}',boverwrite=true)`\r\n\tvar options = {\r\n\t\theaders: headers.getAddHeaders(digest)\r\n\t};\r\n\treturn this._dao.post(url, {}, options);\r\n};\r\n\r\n/**\r\n * Deletes a file\r\n * @param {string} fileUrl - The server relative url of the file you want to delete\r\n * @param {string} [[requestDigest]] - The request digest token used to authorize the request. One will be automatically retrieved if not passed.\r\n * @example\r\n * dao.web.deleteFile(\"/sites/mysite/Shared Documents/myFile.docx\")\r\n *\t\t\t.then(function() { console.log(\"Success\")});\r\n */\r\nWeb.prototype.deleteFile = function(fileUrl, digest) {\r\n\tif (digest) return this._deleteFile(fileUrl, digest);\r\n\r\n\treturn this.getRequestDigest().then(requestDigest => this._deleteFile(fileUrl, requestDigest));\r\n};\r\n\r\nWeb.prototype._deleteFile = function(sourceUrl, requestDigest) {\r\n\tvar url = \"/web/getfilebyserverrelativeurl(@url)/?@Url='\" + sourceUrl + \"'\";\r\n\tvar options = {\r\n\t\theaders: headers.getDeleteHeaders(requestDigest)\r\n\t};\r\n\treturn this._dao.post(url, {}, options);\r\n};\r\n\r\n/**\r\n * Retrieves a users object based on an email address\r\n * @param {string} email - The email address of the user to retrieve\r\n * @returns {Promise<SP.User>} - A Promise that resolves to a an SP.User object\r\n * @example\r\n * dao.web.getUser(\"andrew@andrewpetersen.onmicrosoft.com\")\r\n * \t\t\t.then(function(user) { console.log(user)});\r\n */\r\nWeb.prototype.getUser = function(email) {\r\n\tvar url = this.baseUrl + \"/SiteUsers/GetByEmail('\" + email + \"')\";\r\n\treturn this._dao.get(url).then(utils.validateODataV2);\r\n};\r\n\r\nmodule.exports = Web;"]}