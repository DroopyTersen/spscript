{"version":3,"sources":["../src/web.js"],"names":[],"mappings":"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","file":"web.js","sourcesContent":["var utils = require(\"./utils\");\r\nvar Permissions = require(\"./permissions\");\r\nvar headers = require(\"./requestHeaders\");\r\nvar Folder = require(\"./filesystem\").Folder;\r\n\r\n/**\r\n * Represents a SharePoint site. You shouldn't ever be new'ing this class up up yourself, instead you'll get it from your dao as shown in first example.\r\n * @class\r\n * @param {IBaseDao} dao - Data access object used to make requests.\r\n * @property {Permissions} permissions - allows checking security information of the Web\r\n * @property {string} baseUrl - API relative url (value = \"/web\")\r\n * @example <caption>You access this Web class using the 'web' property of the dao</caption>\r\n * var dao = new SPScript.RestDao(_spPageContextInfo.webAbsoluteUrl);\r\n * dao.web.info().then(function(info) { console.log(info) });\r\n */\r\nvar Web = function(dao) {\r\n\tthis._dao = dao;\r\n\tthis.baseUrl = \"/web\";\r\n\tthis.permissions = new Permissions(this.baseUrl, this._dao);\r\n};\r\n\r\n/**\r\n * Retrieves basic information about the site\r\n * @returns {Promise<SP.Web>} - A Promise that resolves to an object containing non-deferred properties of SP.Web (https://msdn.microsoft.com/en-us/library/office/jj244873.aspx)\r\n * @example\r\n * dao.web.info().then(function(info) { console.log(info) });\r\n */\r\nWeb.prototype.info = function() {\r\n\treturn this._dao\r\n\t\t.get(this.baseUrl)\r\n\t\t.then(utils.validateODataV2);\r\n};\r\n\r\n/**\r\n * Retrieves all of the subsites\r\n * @returns {Promise<SP.Web[]>} - A Promise that resolves to an array of subsite object, each loaded with all non-deferred properties\r\n * @example\r\n *  dao.web.subsites().then(function(sites) { console.log(sites) });\r\n */\r\nWeb.prototype.subsites = function() {\r\n\treturn this._dao\r\n\t\t.get(this.baseUrl + \"/webinfos\")\r\n\t\t.then(utils.validateODataV2);\r\n};\r\n\r\n/**\r\n * Retrieves a token needed to authorize any updates\r\n * @return {string} - A Promise that resolves to a the token that needs to added to the \"X-RequestDigest\" request header\r\n * @example\r\n *  dao.web.getRequestDigest().then(function(digest) { console.log(digest) });\r\n */\r\nWeb.prototype.getRequestDigest = function() {\r\n\treturn this._dao.post('/contextinfo', {})\r\n\t\t.then(data => data.d.GetContextWebInformation.FormDigestValue);\r\n};\r\n\r\n/**\r\n * Retrieves a folder\r\n * @param {string} serverRelativeUrl - The server relative url of the folder\r\n * @returns {Promise<Folder>} - A Promise that resolves to a folder object contain a files and folders arrays\r\n * @example\r\n *  dao.web.getFolder(\"/sites/mysite/Shared Documents\")\r\n *\t\t\t.then(function(folder) { console.log(folder) });\r\n */\r\nWeb.prototype.getFolder = function(serverRelativeUrl) {\r\n\t//remove leading slash\r\n\tif (serverRelativeUrl.charAt(0) === \"/\") {\r\n\t\tserverRelativeUrl = serverRelativeUrl.substr(1);\r\n\t}\r\n\tvar url = \"/web/GetFolderByServerRelativeUrl('\" + serverRelativeUrl + \"')?$expand=Folders,Files\";\r\n\r\n\treturn this._dao.get(url).then(utils.validateODataV2)\r\n\t\t.then(spFolder => {\r\n\t\t\tvar folder = new Folder(spFolder);\r\n\t\t\tfolder.populateChildren(spFolder);\r\n\t\t\treturn folder;\r\n\t\t});\r\n};\r\n\r\n/**\r\n * Uploads a file\r\n * @param {HTML5.File|string} fileContent - Either an HTML5 File object (from a File input element) or the string content of the file\r\n * @param {string} folderUrl - The server relative folder where the file should be uploaded\r\n * @param {object} [[fields]] - An optional object containig the fields that should be set on the file after the upload completes. You can override the filename by passing 'name' property { name: \"NewFileName.docx\"}\r\n * @param {string} [[requestDigest]] - The request digest token used to authorize the request. One will be automatically retrieved if not passed.\r\n * @example <caption>Upload files with file input element, assumes <input type='file' id='file-input' /> </caption>\r\n\t*var inputElement = document.getElementById(\"file-input\");\r\n\t*inputElement.addEventListener(\"change\", handleFiles, false);\r\n\t*function handleFiles() {\r\n\t*    var fileList = this.files;\r\n\t*    var folderUrl = \"/spscript/Shared Documents\";\r\n\t*    for (var i = 0; i < fileList.length; i++) {\r\n\t*        dao.web.uploadFile(fileList[i], folderUrl).then(function(result){\r\n\t*            console.log(result);\r\n\t*        });\r\n\t*    }\r\n\t*}\r\n */\r\nWeb.prototype.uploadFile = function(fileContent, folderUrl, fields, digest) {\r\n\tif (digest) return this._uploadFile(fileContent, folderUrl, fields, digest);\r\n\treturn this.getRequestDigest().then(digest => this._uploadFile(fileContent, folderUrl, fields, digest));\r\n}\r\n\r\nWeb.prototype._uploadFile = function(fileContent, folderUrl, fields, digest) {\r\n\tfields = fields || {};\r\n\t// if its a string, just treat that as the raw content\r\n\tif (typeof fileContent === \"string\") {\r\n\t\tfields.name = fields.name || \"NewFile.txt\";\r\n\t\treturn this._uploadBinaryData(fileContent, folderUrl, fields, digest);\r\n\t}\r\n\r\n\t// If its a browser File object, use FileReader to get ArrayBuffer\r\n\tif (fileContent instanceof File) {\r\n\t\tfields.name = fields.name || fileContent.name\r\n\t\treturn utils.getArrayBuffer(fileContent)\r\n\t\t\t.then(arrayBuffer => this._uploadBinaryData(arrayBuffer, folderUrl, fields, digest))\r\n\t}\r\n};\r\n\r\nWeb.prototype._setFileFields = function(spFile, fields, digest) {\r\n\t// Get the ListItem with ParentList properties so we can query by list title\r\n\treturn this._dao.get(spFile.__metadata.uri + \"/ListItemAllFields?$expand=ParentList\")\r\n\t\t.then(utils.validateODataV2)\r\n\t\t.then(item => {\r\n\t\t\tdelete fields.name;\r\n\t\t\t// if there were no fields passed in just return the file and list item\r\n\t\t\tif (Object.keys(fields).length === 0) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\titem,\r\n\t\t\t\t\tfile: spFile\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t// If extra fields were passed in, update the list item\r\n\t\t\treturn this._dao.lists(item.ParentList.Title).updateItem(item.Id, fields, digest)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\titem = Object.assign({}, item, fields);\r\n\t\t\t\t\treturn { item, file: spFile };\r\n\t\t\t\t})\r\n\t\t})\r\n};\r\n\r\nWeb.prototype._uploadBinaryData = function(binaryContent, folderUrl, fields, digest) {\r\n\tvar uploadUrl = \"/web/GetFolderByServerRelativeUrl('\" + folderUrl + \"')/Files/Add(url='\" + fields.name + \"',overwrite=true)\";\r\n\tvar options = {\r\n\t\theaders: headers.getFilestreamHeaders(digest)\r\n\t};\r\n\treturn this._dao.post(uploadUrl, binaryContent, options)\r\n\t\t.then(utils.validateODataV2)\r\n\t\t.then(spFile => this._setFileFields(spFile, fields, digest));\r\n};\r\n\r\n/**\r\n * Retrieves a file object\r\n * @param {string} url - The server relative url of the file\r\n * @returns {Promise<File>} - A Promise that resolves to a file object\r\n * @example\r\n *  dao.web.getFile(\"/sites/mysite/Shared Documents/myfile.docx\")\r\n *\t\t\t.then(function(file) { console.log(file) });\r\n */\r\nWeb.prototype.getFile = function(url) {\r\n\tvar url = `/web/getfilebyserverrelativeurl('${url}')`\r\n\treturn this._dao.get(url).then(utils.validateODataV2);\r\n};\r\n\r\n/**\r\n * Copies a file\r\n * @param {string} sourceUrl - The server relative url of the file you want to copy\r\n * @param {string} destinationUrl - The server relative url of the destination\r\n * @param {string} [[requestDigest]] - The request digest token used to authorize the request. One will be automatically retrieved if not passed.\r\n * @example\r\n * var sourceFile = \"/sites/mysite/Shared Documents/myfile.docx\";\r\n * var destination = \"/sites/mysite/Restricted Docs/myFile.docx\";\r\n * dao.web.copyFile(sourceFile, destination).then(function() { console.log(\"Success\") });\r\n */\r\nWeb.prototype.copyFile = function(sourceUrl, destinationUrl, digest) {\r\n\tif (digest) return this._copyFile(sourceUrl, destinationUrl, digest);\r\n\r\n\treturn this.getRequestDigest().then(requestDigest => this._copyFile(sourceUrl, destinationUrl, requestDigest));\r\n};\r\n\r\nWeb.prototype._copyFile = function(sourceUrl, destinationUrl, digest) {\r\n\tvar url = `/web/getfilebyserverrelativeurl('${sourceUrl}')/CopyTo` //(strnewurl='${destinationUrl}',boverwrite=true)`\r\n\tvar options = {\r\n\t\theaders: headers.getAddHeaders(digest)\r\n\t};\r\n\tvar body = {\r\n\t\tstrNewUrl: destinationUrl,\r\n\t\tbOverWrite: true\r\n\t}\r\n\treturn this._dao.post(url, body, options);\r\n};\r\n\r\n/**\r\n * Deletes a file\r\n * @param {string} fileUrl - The server relative url of the file you want to delete\r\n * @param {string} [[requestDigest]] - The request digest token used to authorize the request. One will be automatically retrieved if not passed.\r\n * @example\r\n * dao.web.deleteFile(\"/sites/mysite/Shared Documents/myFile.docx\")\r\n *\t\t\t.then(function() { console.log(\"Success\")});\r\n */\r\nWeb.prototype.deleteFile = function(fileUrl, digest) {\r\n\tif (digest) return this._deleteFile(fileUrl, digest);\r\n\r\n\treturn this.getRequestDigest().then(requestDigest => this._deleteFile(fileUrl, requestDigest));\r\n};\r\n\r\nWeb.prototype._deleteFile = function(sourceUrl, requestDigest) {\r\n\tvar url = \"/web/getfilebyserverrelativeurl(@url)/?@Url='\" + sourceUrl + \"'\";\r\n\tvar options = {\r\n\t\theaders: headers.getDeleteHeaders(requestDigest)\r\n\t};\r\n\treturn this._dao.post(url, {}, options);\r\n};\r\n\r\n/**\r\n * Retrieves a users object based on an email address\r\n * @param {string} email - The email address of the user to retrieve\r\n * @returns {Promise<SP.User>} - A Promise that resolves to a an SP.User object\r\n * @example\r\n * dao.web.getUser(\"andrew@andrewpetersen.onmicrosoft.com\")\r\n * \t\t\t.then(function(user) { console.log(user)});\r\n */\r\nWeb.prototype.getUser = function(email) {\r\n\tvar url = this.baseUrl + \"/SiteUsers/GetByEmail('\" + email + \"')\";\r\n\treturn this._dao.get(url).then(utils.validateODataV2);\r\n};\r\n\r\nmodule.exports = Web;"]}