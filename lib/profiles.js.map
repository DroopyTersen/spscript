{"version":3,"sources":["../src/profiles.js"],"names":["utils","require","headers","Profiles","dao","_dao","baseUrl","transformPersonProperties","profile","UserProfileProperties","results","forEach","keyvalue","Key","Value","prototype","current","url","get","then","validateODataV2","setProperty","userOrEmail","key","value","digest","_setProperty","getRequestDigest","args","propertyName","propertyValue","customOptions","getStandardHeaders","getByEmail","accountName","user","AccountName","post","LoginName","getProfile","login","encodeURIComponent","email","web","getUser","module","exports"],"mappings":"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","file":"profiles.js","sourcesContent":["var utils \t\t= require(\"./utils\");\r\nvar headers \t= require(\"./requestHeaders\");\r\n\r\n/**\r\n * Allows you to perform queries agains the SP Profile Service. You shouldn't ever be new'ing this class up up yourself, instead you'll get it from your dao as shown in first example.\r\n * @class\r\n * @param {IBaseDao} dao - Data access object used to make requests.\r\n * @example <caption>You access this Profiles class using the 'profiles' property of the dao</caption>\r\n * var dao = new SPScript.RestDao(_spPageContextInfo.webAbsoluteUrl);\r\n * dao.profiles.current().then(function(profile) { console.log(profile) });\r\n */\r\nvar Profiles = function(dao) {\r\n\tthis._dao = dao;\r\n\tthis.baseUrl = \"/SP.UserProfiles.PeopleManager\";\r\n};\r\n\r\nvar transformPersonProperties = function(profile) {\r\n\tprofile.UserProfileProperties.results.forEach(keyvalue => {\r\n\t\tprofile[keyvalue.Key] = keyvalue.Value;\r\n\t});\r\n\treturn profile;\r\n};\r\n\r\n/**\r\n * Gets the profile of the current user\r\n * @returns {Promise} - A Promise that resolves an object containing all the profile properties\r\n * @example\r\n * dao.profiles.current().then(function(profile) { console.log(profile.PreferredName) });\r\n */\r\nProfiles.prototype.current = function() {\r\n\tvar url = this.baseUrl + \"/GetMyProperties\";\r\n\treturn this._dao.get(url)\r\n\t\t\t\t.then(utils.validateODataV2)\r\n\t\t\t\t.then(transformPersonProperties);\r\n};\r\n\r\n/**\r\n * Sets a profile property\r\n * @param {User|string} userOrEmail - Pass in a User object (must have 'AccountName' or 'LoginName') or an email address\r\n * @returns {Promise} - A Promise\r\n * @example\r\n * var email = \"andrew@andrewpetersen.onmicrosoft.com\";\r\n * var aboutMe = \"I am a web developer\";\r\n * dao.profiles.setProperty(email, \"AboutMe\", aboutMe).then(function() { console.log(\"Success\") });\r\n */\r\nProfiles.prototype.setProperty = function(userOrEmail, key, value, digest) {\r\n\tif (digest) return this._setProperty(userOrEmail, key, value, digest);\r\n\treturn this._dao.getRequestDigest().then(digest => this._setProperty(userOrEmail, key, value, digest));\r\n};\r\n\r\n// Supports email string or a user object\r\nProfiles.prototype._setProperty = function(userOrEmail, key, value, digest) {\r\n\tvar url = this.baseUrl + \"/SetSingleValueProfileProperty\";\r\n\tvar args = {\r\n\t\tpropertyName: key,\r\n\t\tpropertyValue: value,\r\n\t};\r\n\r\n\tvar customOptions = {\r\n\t\theaders: headers.getStandardHeaders(digest)\r\n\t};\r\n\r\n\t// if a string is passed, assume its an email address, otherwise a user was passed\r\n\tif (typeof userOrEmail === \"string\") {\r\n\t\treturn this.getByEmail(userOrEmail).then(user => {\r\n\t\t\targs.accountName = user.AccountName;\r\n\t\t\treturn this._dao.post(url, args, customOptions);\r\n\t\t})\r\n\t} else {\r\n\t\targs.accountName = userOrEmail.LoginName || userOrEmail.AccountName;\r\n\t\treturn this._dao.post(url, args, customOptions);\r\n\t}\r\n};\r\n\r\nProfiles.prototype.getProfile = function(user) {\r\n\tvar login = encodeURIComponent(user.LoginName);\r\n\tvar url = this.baseUrl + \"/GetPropertiesFor(accountName=@v)?@v='\" + login + \"'\";\r\n\treturn this._dao.get(url)\r\n\t\t.then(utils.validateODataV2)\r\n\t\t.then(transformPersonProperties);\r\n};\r\n\r\n/**\r\n * Gets the profile of the user tied to the specified email\r\n * @returns {Promise} - A Promise that resolves an object containing all the profile properties\r\n * @example\r\n * var email = \"andrew@andrewpetersen.onmicrosoft.com\";\r\n * dao.profiles.getByEmail(email)\r\n *    .then(function(profile) { console.log(profile.PreferredName) });\r\n */\r\nProfiles.prototype.getByEmail = function(email) {\r\n\treturn this._dao.web.getUser(email).then(user => this.getProfile(user));\r\n};\r\n\r\nmodule.exports = Profiles;"]}