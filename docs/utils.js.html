<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @namespace SPScript.utils
*/

/**
 * If you pass in string, it will try to run JSON.parse(). Different browsers handle JSON response differently so it is safest to call this method if you are making a generic GET or POST request
 * @param {string} data - Raw response from JSON request
 * @returns {object} - JSON parsed object. Returns null if JSON.parse fails
 * @function parseJSON
 * @memberof SPScript.utils
 * @example
 * dao.get('/web/contentTypes')
 *		.then(SPScript.utils.parseJSON)
 *		.then(function(data) { console.log(data.d.results)})
 */
var parseJSON = exports.parseJSON = function(data) {
		if (typeof data === "string") {
			try {
				data = JSON.parse(data);
			} catch (e) {
				return null;
			}
		}
		return data;	
};

/**
 * Helps parse raw json response to remove ceremonious OData data.d namespace. Tries JSON.parse() and then pulling out actual result from data.d or data.d.results
 * @function validateODataV2
 * @memberof SPScript.utils
 * @param {string|object} data - Raw response from JSON request
 * @returns {object} - JSON parsed object with that removes data.d OData structure 
 * @example
 * dao.get('/web/contentTypes')
 *		.then(SPScript.utils.validateODataV2)
 *		.then(function(contentTypes) { console.log(contentTypes)})
 */
var validateODataV2 = exports.validateODataV2= function(data) {
		var results = parseJSON(data);
		if (data.d &amp;&amp; data.d.results &amp;&amp; data.d.results.length != null) {
			results = data.d.results;
		} else if (data.d) {
			results = data.d;
		}
		return results;	
};

//'Borrowed' from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators
var arrayFromBitMask = exports.arrayFromBitMask = function(nMask) {
	// nMask must be between -2147483648 and 2147483647
	if (typeof nMask === "string") {
		nMask = parseInt(nMask);
	}
	// if (nMask > 0x7fffffff || nMask &lt; -0x80000000) { 
	// 	throw new TypeError("arrayFromMask - out of range"); 
	// }
	for (var nShifted = nMask, aFromMask = []; nShifted; aFromMask.push(Boolean(nShifted &amp; 1)), nShifted >>>= 1);
	return aFromMask;
};

var _waitForLibraries = function(namespaces, resolve) {
	var missing = namespaces.filter(namespace => !validateNamespace(namespace));
		
	if (missing.length === 0) resolve();
	else setTimeout(() => _waitForLibraries(namespaces, resolve), 25);
};

/**
 * A method to allow you to wait for script dependencies to load.
 * @param {Array} namespaces - An array of global namespaces, things on the global 'window'. For example, when jQuery is on the page, window.jQuery is valid.  So 'jQuery' is the namespace.
 * @returns {Promise} - A Promise that resolves when all your namespaces are on the page
 * @function waitForLibraries
 * @memberof SPScript.utils
 * @example
 * function doMyStuff() { };
 * SPScript.utils.waitForLibraries(["jQuery", "SP.UI.Dialog"]).then(doMyStuff);
 */
var waitForLibraries = exports.waitForLibraries = function(namespaces) {
	return new Promise((resolve, reject) => _waitForLibraries(namespaces, resolve));
};

/**
 * A method to allow you to wait for a single script dependency to load.
 * @param {Array} namespaces - A global namespace. For example, when jQuery is on the page, window.jQuery is valid. So 'jQuery' is the namespace.
 * @returns {Promise} - A Promise that resolves when all your namespace is on the page
 * @function waitForLibrary
 * @memberof SPScript.utils
 * @example
 * function doMyStuff() { };
 * SPScript.utils.waitForLibrary("jQuery").then(doMyStuff);
 */
var waitForLibrary = exports.waitForLibrary = (namespace) => waitForLibraries([namespace])

var validateNamespace = exports.validateNamespace = function(namespace) {
	var scope = window;
	var sections = namespace.split(".");
	var sectionsLength = sections.length;
	for (var i = 0; i &lt; sectionsLength; i++) {
		var prop = sections[i];
		if (prop in scope) {
			scope = scope[prop]
		} else {
			return false;
		}
	}
	return true;
};

var getScripts = exports.getScripts = function(urls) {
	return Promise.all(urls.map(getScript));
};

var getScript = exports.getScript = function(url) {
	return new Promise((resolve, reject) => {
		var scriptTag = window.document.createElement("script");
		var firstScriptTag = document.getElementsByTagName('script')[0];
		scriptTag.async = 1;
		firstScriptTag.parentNode.insertBefore(scriptTag, firstScriptTag);

		scriptTag.onload = scriptTag.onreadystatechange = function(arg, isAbort) {
			// if its been aborted, readyState is gone, or readyState is in a 'done' status
			if(isAbort || !scriptTag.readyState || /loaded|complete/.test(script.readyState)) {
				//clean up
				scriptTag.onload = scriptTag.onreadystatechange = null;
				scriptTag = undefined;

				// resolve/reject the promise
				if (!isAbort) resolve();
				else reject;
			}
		}
		scriptTag.src = url;
	});
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="RestDao.html">RestDao</a></li><li><a href="Web.html">Web</a></li></ul><h3>Namespaces</h3><ul><li><a href="SPScript.utils.html">utils</a></li></ul><h3>Global</h3><ul><li><a href="global.html#BaseDao">BaseDao</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sat Apr 30 2016 14:47:11 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
