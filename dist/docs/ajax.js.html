<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ajax.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="docstyles.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">SPScript Docs<br/><span style='display:none'>Source: ajax.js</span></h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @namespace SPScript.ajax
*/

var defaults = {
	method: "GET",
	async: true,
	type: "json", //XMLHttpRequest.responseType
	data: undefined
};

var validMethods = [
	"GET",
	"POST",
	"PUT",
	"HEAD",
	"DELETE",
	"PATCH"
];

var errorHandlers = [];

var validateOptions = function(options) {
	if (!options || !options.url || validMethods.indexOf(options.method) &lt; 0)
		return false
	else return true
};

var setHeaders = function(xhr, headersObj) {
	if (headersObj) {
		Object.keys(headersObj).forEach(key => {
			xhr.setRequestHeader(key, headersObj[key]);
		})
	}
};

/**
 * Performs and AJAX request based on options you pass you. Your options must at least have a url.
 * @param {object} options - Request options like { url, headers, method };
 * @returns {Promise} - A ES6 Promise that resolves or rejects when the request comes back
 * @function ajax
 * @memberof SPScript.ajax
 * @example
 * var ajaxOptions = { 
 *    url: '/_api/web/contentTypes', 
 *    method: "GET", 
 *    headers: { Accept: "application/json;odata=verbose" } 
 * };
 * SPScript.utils.ajax(ajaxOptions)
 *		.then(SPScript.utils.parseJSON)
 *		.then(function(data){ console.log(data.d.results) })
 *		.catch(function(error) { console.log(error)})
 */
var ajax = function(options) {
	var opts = Object.assign({}, defaults, options);
	if (!validateOptions(options))
		return Promise.reject(new Error("Invalid options passed into ajax call."));

	var xhr = new XMLHttpRequest();
	if (xhr == null) 
		return Promise.reject(new Error("Your browser doesn't support XMLHttpRequest (ajax)."));


	xhr.open(opts.method, opts.url, opts.async);
	setHeaders(xhr, opts.headers);
	xhr.responseType = opts.type;

	return new Promise((resolve, reject) => {
		xhr.onreadystatechange = function() {
			//completed
			if (xhr.readyState === 4) {
				// SUCCESS
				if (xhr.status &lt; 400 &amp;&amp; xhr.status >= 100) {
					resolve(xhr.response);
				} else {
					var error = new Error("AJAX Request Error: Response Code = " + xhr.status);
					error.code = xhr.status;
					errorHandlers.forEach(fn => fn(error, xhr));
					reject(error);
				}
			}
		};

		xhr.send(opts.data);
	})
}

ajax.addErrorHandler = (fn) => errorHandlers.push(fn);
ajax.setDefaults = (options) => Object.assign(defaults, options);

module.exports = ajax;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="RestDao.html">RestDao</a></li><li><a href="Search.html">Search</a></li><li><a href="Web.html">Web</a></li></ul><h3>Namespaces</h3><ul><li><a href="SPScript.ajax.html">ajax</a></li><li><a href="SPScript.queryString.html">queryString</a></li><li><a href="SPScript.utils.html">utils</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun May 01 2016 01:51:52 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); 
console.log("here");
document.querySelector("a[href='index.html']").href = "../index.html";
</script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>