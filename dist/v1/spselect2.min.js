!function e(t,r,n){function i(o,a){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var u=r[o]={exports:{}};t[o][0].call(u.exports,function(e){var r=t[o][1][e];return i(r?r:e)},u,u.exports,e,t,r,n)}return r[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){SPScript=e("./spscript"),SPScript.List=e("./list"),SPScript.Web=e("./web"),SPScript.Profiles=e("./profiles"),SPScript.helpers=e("./helpers");var n=e("./filesystem");SPScript.File=n.File,SPScript.Folder=n.Folder,function(e,t){var r=function(){var t=this;t.web=new e.Web(t),t.search=new e.Search(t),t.profiles=new e.Profiles(t)};r.prototype.executeRequest=function(){throw"Not implemented exception"},r.prototype.get=function(e,r,n){var i={type:"GET"};return r&&t.extend(i,r),this.executeRequest(e,i)},r.prototype.lists=function(t){return t?new e.List(t,this):this.get("/web/lists").then(e.helpers.validateODataV2)},r.prototype.post=function(e,r,n){var i=JSON.stringify(r),s={type:"POST",data:i,contentType:"application/json;odata=verbose"};return t.extend(s,n),this.executeRequest(e,s)},r.prototype.getFolder=function(t){"/"===t.charAt(0)&&(t=t.substr(1));var r="/web/GetFolderByServerRelativeUrl('"+t+"')?$expand=Folders,Files";return this.get(r).then(e.helpers.validateODataV2).then(function(e){var t=new SPScript.Folder(e);return t.populateChildren(e),t})},r.prototype.uploadFile=function(e,t,r){var n="/web/GetFolderByServerRelativeUrl('"+e+"')/Files/Add(url='"+t+"',overwrite=true)",i={binaryStringRequestBody:!0,state:"Update"};return this.post(n,r,i)},e.BaseDao=r}(SPScript,jQuery),t.exports=SPScript.BaseDao},{"./filesystem":3,"./helpers":4,"./list":5,"./profiles":8,"./spscript":12,"./web":13}],2:[function(e,t,r){(function(r){r.SPSelect2=e("../plugins/SPSelect2/spselect2"),t.exports=r.SPSelect2}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../plugins/SPSelect2/spselect2":7}],3:[function(e,t,r){var n=e("./spscript");n.helpers=e("./helpers"),function(e){var t=function(e){var t=this;t.mapProperties(e)};t.prototype.populateChildren=function(e){this.folders=e.Folders.results.map(function(e){return new t(e)}),this.files=e.Files.results.map(function(e){return new r(e)})},t.prototype.mapProperties=function(e){this.name=e.Name,this.serverRelativeUrl=e.ServerRelativeUrl,this.itemCount=e.ItemCount,this.guid=e.UniqueId,this.uri=e.__metadata.uri};var r=function(e){this.mapProperties(e)};r.prototype.mapProperties=function(e){this.name=e.Name,this.title=e.Title,this.checkoutType=e.CheckOutType,this.byteLength=e.Length,this.majorVersion=e.MajorVersion,this.minorVersion=e.MinorVersion,this.serverRelativeUrl=e.ServerRelativeUrl,this.uri=e.__metadata.uri},e.File=r,e.Folder=t}(n),t.exports={File:n.File,Folder:n.Folder}},{"./helpers":4,"./spscript":12}],4:[function(e,t,r){var n=e("./spscript.js");!function(e){var t={};t.validateODataV2=function(e){var t=e;return e.d&&e.d.results&&null!=e.d.results.length?t=e.d.results:e.d&&(t=e.d),t},t.validateCrossDomainODataV2=function(e){var r=$.parseJSON(e.body);t.validateODataV2(r)},t.arrayFromBitMask=function(e){"string"==typeof e&&(e=parseInt(e));for(var t=e,r=[];t;r.push(Boolean(1&t)),t>>>=1);return r},e.helpers=t}(n),t.exports=n.helpers},{"./spscript.js":12}],5:[function(e,t,r){var n=e("./spscript");n.helpers=e("./helpers"),n.permissions=e("./permissions"),function(e,t){var r=null,n=function(e,t){this.listname=e,r="/web/lists/getbytitle('"+e+"')",this._dao=t};n.prototype.getItems=function(t){var n=null!=t?"?"+t:"";return this._dao.get(r+"/items"+n).then(e.helpers.validateODataV2)},n.prototype.getItemById=function(t,n){var i=r+"/items("+t+")";return i+=null!=n?"?"+n:"",this._dao.get(i).then(e.helpers.validateODataV2)},n.prototype.info=function(){return this._dao.get(r).then(e.helpers.validateODataV2)},n.prototype.addItem=function(n){var i=this;return i._dao.get(r).then(function(s){n=t.extend({__metadata:{type:s.d.ListItemEntityTypeFullName}},n);var o={headers:{Accept:"application/json;odata=verbose","X-RequestDigest":t("#__REQUESTDIGEST").val()}};return i._dao.post(r+"/items",n,o).then(e.helpers.validateODataV2)})},n.prototype.updateItem=function(e,r){var n=this;return n.getItemById(e).then(function(e){r=t.extend({__metadata:{type:e.__metadata.type}},r);var i={headers:{Accept:"application/json;odata=verbose","X-RequestDigest":t("#__REQUESTDIGEST").val(),"X-HTTP-Method":"MERGE","If-Match":e.__metadata.etag}};return n._dao.post(e.__metadata.uri,r,i)})},n.prototype.deleteItem=function(e){var r=this;return r.getItemById(e).then(function(e){var n={headers:{Accept:"application/json;odata=verbose","X-RequestDigest":t("#__REQUESTDIGEST").val(),"X-HTTP-Method":"DELETE","If-Match":e.__metadata.etag}};return r._dao.post(e.__metadata.uri,"",n)})},n.prototype.findItems=function(e,t,r){var n="string"==typeof t?"'"+t+"'":t,i="$filter="+e+" eq "+n;return i+=null!=r?"&"+r:"",this.getItems(i)},n.prototype.findItem=function(e,t,r){return this.findItems(e,t,r).then(function(e){return e&&e.length&&e.length>0?e[0]:null})},n.prototype.permissions=function(t){return e.permissions(r,this._dao,t)},e.List=n}(n,jQuery),t.exports=n.List},{"./helpers":4,"./permissions":6,"./spscript":12}],6:[function(e,t,r){var n=e("./spscript");n.helpers=e("./helpers"),function(e){var t={roleAssignment:function(e){var t={member:{login:e.Member.LoginName,name:e.Member.Title,id:e.Member.Id}};return t.roles=e.RoleDefinitionBindings.results.map(function(e){return{name:e.Name,description:e.Description,basePermissions:r(e.BasePermissions.Low,e.BasePermissions.High)}}),t}},r=function(e,t){var r=[];return i.forEach(function(n){((n.low&e)>0||(n.high&t)>0)&&r.push(n.name)}),r},n=function(n,i,s){if(!s){var o=n+"/RoleAssignments?$expand=Member,RoleDefinitionBindings";return i.get(o).then(e.helpers.validateODataV2).then(function(e){return e.map(t.roleAssignment)})}var a=function(t){console.log(t);var r=encodeURIComponent(t.LoginName),s=n+"/getusereffectivepermissions(@v)?@v='"+r+"'";return i.get(s).then(e.helpers.validateODataV2)},l="current"===s?i.get("/web/getuserbyid("+_spPageContextInfo.userId+")").then(function(e){return e.d}):i.web.getUser(s);return l.then(a).then(function(e){return r(e.GetUserEffectivePermissions.Low,e.GetUserEffectivePermissions.High)})},i=[{name:"emptyMask",low:0,high:0},{name:"viewListItems",low:1,high:0},{name:"addListItems",low:2,high:0},{name:"editListItems",low:4,high:0},{name:"deleteListItems",low:8,high:0},{name:"approveItems",low:16,high:0},{name:"openItems",low:32,high:0},{name:"viewVersions",low:64,high:0},{name:"deleteVersions",low:128,high:0},{name:"cancelCheckout",low:256,high:0},{name:"managePersonalViews",low:512,high:0},{name:"manageLists",low:2048,high:0},{name:"viewFormPages",low:4096,high:0},{name:"anonymousSearchAccessList",low:8192,high:0},{name:"open",low:65536,high:0},{name:"viewPages",low:131072,high:0},{name:"addAndCustomizePages",low:262144,high:0},{name:"applyThemeAndBorder",low:524288,high:0},{name:"applyStyleSheets",low:1048576,high:0},{name:"viewUsageData",low:2097152,high:0},{name:"createSSCSite",low:4194304,high:0},{name:"manageSubwebs",low:8388608,high:0},{name:"createGroups",low:16777216,high:0},{name:"managePermissions",low:33554432,high:0},{name:"browseDirectories",low:67108864,high:0},{name:"browseUserInfo",low:134217728,high:0},{name:"addDelPrivateWebParts",low:268435456,high:0},{name:"updatePersonalWebParts",low:536870912,high:0},{name:"manageWeb",low:1073741824,high:0},{name:"anonymousSearchAccessWebLists",low:-2147483648,high:0},{name:"useClientIntegration",low:0,high:16},{name:"useRemoteAPIs",low:0,high:32},{name:"manageAlerts",low:0,high:64},{name:"createAlerts",low:0,high:128},{name:"editMyUserInfo",low:0,high:256},{name:"enumeratePermissions",low:0,high:1073741824}];e.permissions=n}(n),t.exports=n.permissions},{"./helpers":4,"./spscript":12}],7:[function(e,t,r){var n=e("../../restDao"),i=function(e,t){var r=document.getElementsByTagName("head")[0];if(!window.jQuery){var i=document.createElement("script");i.setAttribute("src","//code.jquery.com/jquery-2.1.4.min.js"),i.setAttribute("type","text/javascript"),r.appendChild(i)}var s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("href","//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css"),r.appendChild(s);var o=function(e){var t={};t.Templates={Fields:{}},t.Templates.Fields[e]={EditForm:a,NewForm:a},SPClientTemplates.TemplateManager.RegisterTemplateOverrides(t)},a=function(e){var r=SPClientTemplates.Utility.GetFormContextForCurrentField(e);console.log(r);var i=r.webAttributes.WebUrl,s=new n(i),o="LookupMulti"===r.fieldSchema.FieldType?"multiple='multple'":"",a="<select id='"+r.fieldName+"' "+o+"class='ms-long' name='"+r.fieldName+"'><option value=''></option></select>",l="[name='"+r.fieldName+"']";return r.registerGetValueCallback(r.fieldName,function(){var e=$(l).val();return"LookupMulti"===r.fieldSchema.FieldType&&(e=e.join(";#")),e}),$(document).ready(function(){$.getScript("//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js").then(function(){$(l).select2({minimumInputLength:1,placeholder:"Begin typing...",ajax:{delay:150,url:"",data:function(e){return{q:e.term}},processResults:function(e){var t=e.map(function(e){return{id:e.Id+";#"+e.Title,text:e.Title}});return{results:t}},cache:!0,transport:function(e,r,n){var i=e.data.q||"",o="$top=10&$select=Title, Id&$filter=substringof('"+i+"', Title)";s.lists(t).getItems(o).then(function(e){r(e)},n)}}})})}),a};o(e)};r.init=i},{"../../restDao":10}],8:[function(e,t,r){var n=e;n.helpers=e("./helpers"),function(e){var t=function(e){this._dao=e,this.baseUrl="/SP.UserProfiles.PeopleManager"},r=function(e){return e.UserProfileProperties.results.forEach(function(t){e[t.Key]=t.Value}),e};t.prototype.current=function(){var t=this.baseUrl+"/GetMyProperties";return this._dao.get(t).then(e.helpers.validateODataV2).then(r)},t.prototype.setProperty=function(e,t,r){var n=this,i=this.baseUrl+"/SetSingleValueProfileProperty",s={propertyName:t,propertyValue:r},o={headers:{Accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val()}};return"string"==typeof e?n.getByEmail(e).then(function(e){return s.accountName=e.AccountName,n._dao.post(i,s,o)}):(s.accountName=e.LoginName||e.AccountName,n._dao.post(i,s,o))},t.prototype.getProfile=function(t){var n=encodeURIComponent(t.LoginName),i=this.baseUrl+"/GetPropertiesFor(accountName=@v)?@v='"+n+"'";return this._dao.get(i).then(e.helpers.validateODataV2).then(r)},t.prototype.getByEmail=function(e){var t=this;return t._dao.web.getUser(e).then(function(e){return t.getProfile(e)})},e.Profiles=t}(n),t.exports=n.Profiles},{"./helpers":4}],9:[function(e,t,r){SPScript=e("./spscript"),function(e){e.queryString={_queryString:{},_processed:!1,_processQueryString:function(e){for(var t,r=e||window.location.search.substring(1),n=r.split("&"),i=0;i<n.length;i++)t=n[i].split("="),this._queryString[t[0]]=decodeURIComponent(t[1].replace(/\+/g," "));this._processed=!0},contains:function(e,t){return this._processed||this._processQueryString(t),this._queryString.hasOwnProperty(e)},getValue:function(e,t){return this._processed||this._processQueryString(t),this.contains(e)?this._queryString[e]:""},getAll:function(e){return this._processed||this._processQueryString(e),this._queryString},objectToQueryString:function(e,t){var r=[];for(var n in e)value=e[n],null!==value&&(t?r.push(encodeURIComponent(n)+"='"+encodeURIComponent(value)+"'"):r.push(encodeURIComponent(n)+"="+encodeURIComponent(value)));return r.join("&")}}}(SPScript),t.exports=SPScript.queryString},{"./spscript":12}],10:[function(e,t,r){var n=e("./spscript");n.BaseDao=e("./baseDao"),n.Search=e("./search"),function(e,t){var r=function(t){e.BaseDao.call(this),this.webUrl=t};r.prototype=new e.BaseDao,r.prototype.executeRequest=function(e,r){var n=/^http/i.test(e)?e:this.webUrl+"/_api"+e,i={url:n,type:"GET",headers:{Accept:"application/json; odata=verbose"}};return t.extend(i,r),t.ajax(i)},e.RestDao=r}(n,jQuery),t.exports=n.RestDao},{"./baseDao":1,"./search":11,"./spscript":12}],11:[function(e,t,r){SPScript=e("./spscript"),SPScript.RestDao=e("./restDao"),SPScript.queryString=e("./queryString"),function(e){var t=function(t){"string"==typeof t?this.dao=new e.RestDao(t):this.dao=t};t.QueryOptions=function(){this.sourceid=null,this.startrow=null,this.rowlimit=30,this.selectedproperties=null,this.refiners=null,this.refinementfilters=null,this.hiddenconstraints=null,this.sortlist=null};var r=function(e){for(var t=[],r=0;r<e.length;r++){for(var n=e[r],i={},s=0;s<n.Cells.results.length;s++)i[n.Cells.results[s].Key]=n.Cells.results[s].Value;t.push(i)}return t},n=function(e){this.elapsedTime=e.ElapsedTime,this.suggestion=e.SpellingSuggestion,this.resultsCount=e.PrimaryQueryResult.RelevantResults.RowCount,this.totalResults=e.PrimaryQueryResult.RelevantResults.TotalRows,this.totalResultsIncludingDuplicates=e.PrimaryQueryResult.RelevantResults.TotalRowsIncludingDuplicates,this.items=r(e.PrimaryQueryResult.RelevantResults.Table.Rows.results)};t.prototype.query=function(t,r){var i=this,s=null!=r?"&"+e.queryString.objectToQueryString(r,!0):"",o=new $.Deferred,a="/search/query?querytext='"+t+"'"+s,l=i.dao.get(a);return l.done(function(e){if(e.d&&e.d.query){var t=new n(e.d.query);o.resolve(t)}else o.reject(e)}),o.promise()},t.prototype.people=function(e,t){var r=t||{};return r.sourceid="b09a7990-05ea-4af9-81ef-edfab16c4e31",this.query(e,r)},e.Search=t}(SPScript),t.exports=SPScript.Search},{"./queryString":9,"./restDao":10,"./spscript":12}],12:[function(e,t,r){t.exports={}},{}],13:[function(e,t,r){var n=e;n.helpers=e("./helpers"),n.permissions=e("./permissions"),function(e){var t="/web",r=function(e){this._dao=e};r.prototype.info=function(){return this._dao.get(t).then(e.helpers.validateODataV2)},r.prototype.subsites=function(){return this._dao.get(t+"/webinfos").then(e.helpers.validateODataV2)},r.prototype.permissions=function(r){return e.permissions(t,this._dao,r)},r.prototype.getUser=function(r){var n=t+"/SiteUsers/GetByEmail('"+r+"')";return this._dao.get(n).then(e.helpers.validateODataV2)},e.Web=r}(n),t.exports=n.Web},{"./helpers":4,"./permissions":6}]},{},[2]);