!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SPScript",[],t):"object"==typeof exports?exports.SPScript=t():e.SPScript=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,n){"use strict";function r(){return!("undefined"==typeof window)}function o(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return null}return e}function a(e){e=o(e);var t=null;return e.d&&e.d.results&&null!=e.d.results.length?t=e.d.results:e.d&&(t=e.d),t||e}function i(e,t){f().then(function(){var n={title:" "},r=Object.assign({},n,t,{url:e});return SP.UI.ModalDialog.showModalDialog(r)})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(7),u=n(10),l=n(11),c=n(12),h=function(e){if(e&&e instanceof File)return new Promise(function(t,n){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsArrayBuffer(e)});throw"SPScript.utils.getArrayBuffer: Cant get ArrayBuffer if you don't pass in a file"},f=function(){return c.validateNamespace("SP.UI.ModalDialog")?Promise.resolve(!0):l.loadScript("/_layouts/15/1033/sp.res.js").then(function(){return l.loadScript("/_layouts/15/sp.ui.dialog.js")})},p={isBrowser:r,headers:u.default,parseJSON:o,validateODataV2:a,qs:{toObj:s.toObj,fromObj:s.fromObj},loadScript:l.loadScript,loadScripts:l.loadScripts,loadCSS:l.loadCSS,getArrayBuffer:h,waitForLibraries:c.waitForLibraries,waitForLibrary:c.waitForLibrary,validateNamespace:c.validateNamespace,waitForElement:c.waitForElement,openModal:i};t.default=p},function(e,t,n){"use strict";t.decode=t.parse=n(8),t.encode=t.stringify=n(9)},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o={method:"GET",credentials:"include",redirect:"follow"},a=function(e,t){var n=Object.assign({},o,t);return fetch(e,n).then(function(e){e.ok;return e.ok?e.text().then(function(e){return r.default.parseJSON(e)||e}):e.text().then(function(e){throw new Error(e)})})};t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(15),a=function(){function e(e,t){this.baseUrl=e,this._dao=t}return e.prototype.getRoleAssignments=function(){var e=this.baseUrl+"/RoleAssignments?$expand=Member,RoleDefinitionBindings";return this._dao.get(e).then(r.default.validateODataV2).then(function(e){return e.map(i)})},e.prototype.checkPrivs=function(e){var t=encodeURIComponent(e.LoginName),n=this.baseUrl+"/getusereffectivepermissions(@v)?@v='"+t+"'";return this._dao.get(n).then(r.default.validateODataV2)},e.prototype.check=function(e){var t=this;return e||r.default.isBrowser()?(e?this._dao.web.getUser(e):this._dao.get("/web/getuserbyid("+_spPageContextInfo.userId+")").then(function(e){return e.d})).then(function(e){return t.checkPrivs(e)}).then(function(e){return s(e.GetUserEffectivePermissions.Low,e.GetUserEffectivePermissions.High)}):Promise.reject("Can't check permissions. No email passed and no current user")},e}();t.default=a;var i=function(e){return{member:{login:e.Member.LoginName,name:e.Member.Title,id:e.Member.Id},roles:e.RoleDefinitionBindings.results.map(function(e){return{name:e.Name,description:e.Description,basePermissions:s(e.BasePermissions.Low,e.BasePermissions.High)}})}},s=function(e,t){var n=[];return o.basePermissions.forEach(function(r){((r.low&e)>0||(r.high&t)>0)&&n.push(r.name)}),n}},function(e,t,n){"use strict";var r=n(6);e.exports=r.default},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(13),a=n(27),i={utils:r.default,CSR:a.default,createContext:function(t,n){try{return!t&&e._spPageContextInfo&&(t=e._spPageContextInfo.webAbsoluteUrl),new o.default(t,n)}catch(e){throw new Error("Unable to create SPScript Context: "+e.message)}}};t.default=i}).call(t,n(2))},function(e,t,n){"use strict";function r(e,t){var n=function(n){var r=(e[n]+"").trim();return(r.indexOf(" ")>-1||t)&&(r="'"+r+"'"),n+"="+r};return Object.keys(e).map(n).join("&")}function o(e){return void 0===e&&window&&window.location&&window.location.search&&(e=window.location.search),e?("?"===e[0]&&(e=e.substr(1)),a.parse(e)):{}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1);t.fromObj=r,t.toObj=o},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,a){t=t||"&",n=n||"=";var i={};if("string"!=typeof e||0===e.length)return i;var s=/\+/g;e=e.split(t);var u=1e3;a&&"number"==typeof a.maxKeys&&(u=a.maxKeys);var l=e.length;u>0&&l>u&&(l=u);for(var c=0;c<l;++c){var h,f,p,d,m=e[c].replace(s,"%20"),g=m.indexOf(n);g>=0?(h=m.substr(0,g),f=m.substr(g+1)):(h=m,f=""),p=decodeURIComponent(h),d=decodeURIComponent(f),r(i,p)?o(i[p])?i[p].push(d):i[p]=[i[p],d]:i[p]=d}return i};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var o=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(i(e),function(i){var s=encodeURIComponent(o(i))+n;return a(e[i])?r(e[i],function(e){return s+encodeURIComponent(o(e))}).join(t):s+encodeURIComponent(o(e[i]))}).join(t):s?encodeURIComponent(o(s))+n+encodeURIComponent(o(e)):""};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";function r(e){var t={Accept:o,"Content-Type":o};return e&&(t["X-RequestDigest"]=e),t}Object.defineProperty(t,"__esModule",{value:!0});var o="application/json;odata=verbose",a=r,i=function(e){return{Accept:o,"X-RequestDigest":e,"Content-Type":"application/octet-stream",binaryStringRequestBody:"true"}},s=function(e,t){return Object.assign({},r(t),{"X-HTTP-Method":e})},u=function(e,t){return t&&(e["If-Match"]=t),e},l=function(e,t){return u(s("MERGE",e),t)},c=function(e,t){return u(s("DELETE",e),t)},h={getStandardHeaders:r,getAddHeaders:a,getFilestreamHeaders:i,getUpdateHeaders:l,getDeleteHeaders:c,getActionHeaders:s};t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadCSS=function(e){var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.querySelector("head").appendChild(t)},t.loadScript=function(e){return new Promise(function(t,n){var r=window.document.createElement("script"),o=document.getElementsByTagName("script")[0];r.async=!0,o.parentNode.insertBefore(r,o),r.onload=r.onreadystatechange=function(e,n){(n||!r.readyState||/loaded|complete/.test(r.readyState))&&(r.onload=r.onreadystatechange=null,r=void 0,n||t())},r.src=e})},t.loadScripts=function(e){return Promise.all(e.map(t.loadScript))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateNamespace=function(e){for(var t=window,n=e.split("."),r=n.length,o=0;o<r;o++){var a=n[o];if(!(a in t))return!1;t=t[a]}return!0};var r=function(e,n){0===e.filter(function(e){return!t.validateNamespace(e)}).length?n():setTimeout(function(){return r(e,n)},25)};t.waitForLibraries=function(e){return new Promise(function(t,n){return r(e,t)})},t.waitForLibrary=function(e){return t.waitForLibraries([e])},t.waitForElement=function(e,t){void 0===t&&(t=5e3);var n=0,r=t/25;return new Promise(function(t,o){var a=function(){n>r&&o("Unable to find element: "+e);var i=document.querySelector(e);i?t(i):(n++,setTimeout(a,25))};a()})}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,a&&(i=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,a=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){u.label=n[1];break}if(6===n[0]&&u.label<i[1]){u.label=i[1],i=n;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(n);break}i[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],a=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,a,i,s,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),i=n(0),s=n(14),u=n(16),l=n(17),c=n(19),h=n(21),f=n(22),p=function(){function e(e,t){void 0===t&&(t={});var n=this;this.webUrl=e,this.clientId=t.clientId,this.clientSecret=t.clientSecret,this.accessToken=t.token,this.ensureToken=t.clientSecret?f.getAppOnlyToken(e,t.clientId,t.clientSecret).then(function(e){return n.accessToken=e}):Promise.resolve(this.accessToken||!0),this.search=new l.default(this),this.customActions=new c.default(this),this.web=new u.default(this),this.profiles=new h.default(this)}return e.prototype.executeRequest=function(e,t){return r(this,void 0,void 0,function(){var n,r,i;return o(this,function(o){switch(o.label){case 0:return[4,this.ensureToken];case 1:return o.sent(),n=/^http/i.test(e)?e:this.webUrl+"/_api"+e,r={method:"GET",headers:{Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose"}},i=Object.assign({},r,t),this.accessToken&&(i.headers.Authorization="Bearer "+this.accessToken),[2,a.default(n,i)]}})})},e.prototype.get=function(e,t){var n=Object.assign({},{method:"GET"},t);return this.executeRequest(e,n).then(i.default.parseJSON)},e.prototype.post=function(e,t,n){t=this._packagePostBody(t,n);var r={method:"POST",body:t};return r=Object.assign({},r,n),this.executeRequest(e,r).then(i.default.parseJSON)},e.prototype.authorizedPost=function(e,t,n){var r=this;return this.getRequestDigest().then(function(e){return i.default.headers.getActionHeaders(n,e)}).then(function(n){return r.post(e,t,{headers:n})})},e.prototype._ensureRequestDigest=function(e){return e?Promise.resolve(e):this.getRequestDigest()},e.prototype.getRequestDigest=function(){return this.post("/contextInfo",{}).then(function(e){return e.d.GetContextWebInformation.FormDigestValue})},e.prototype.lists=function(e){return new s.default(e,this)},e.prototype._packagePostBody=function(e,t){return"string"==typeof e?e:t&&t.headers&&t.headers["Content-Type"]&&-1===t.headers["Content-Type"].indexOf("json")?e:JSON.stringify(e)},e}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(4),a=function(){function e(e,t){this.listName=e,this.baseUrl="/web/lists/getbytitle('"+this.listName+"')",this._dao=t,this.permissions=new o.default(this.baseUrl,t)}return e.prototype.getItems=function(e){return this._dao.get(this.baseUrl+"/items"+i(e)).then(r.default.validateODataV2)},e.prototype.getItemById=function(e,t){var n=this.baseUrl+"/items("+e+")"+i(t);return this._dao.get(n).then(r.default.validateODataV2)},e.prototype.getItemsByView=function(e){var t=this,n=this.baseUrl+"/Views/getByTitle('"+e+"')/ViewQuery";return this._dao.get(n).then(r.default.validateODataV2).then(function(e){var n=t.baseUrl+"/GetItems",r={query:{__metadata:{type:"SP.CamlQuery"},ViewXml:e.ViewQuery}};return t._dao.authorizedPost(n,r)}).then(r.default.validateODataV2)},e.prototype.findItems=function(e,t,n){return n="$filter="+e+" eq "+("string"==typeof t?"'"+t+"'":t)+i(n,"&"),this.getItems(n)},e.prototype.findItem=function(e,t,n){return this.findItems(e,t,n).then(function(e){return e&&e.length&&e.length>0?e[0]:null})},e.prototype.getInfo=function(){return this._dao.get(this.baseUrl).then(r.default.validateODataV2)},e.prototype.addItem=function(e,t){var n=this;return this._dao._ensureRequestDigest(t).then(function(t){return n._dao.get(n.baseUrl).then(function(o){e=Object.assign({},{__metadata:{type:o.d.ListItemEntityTypeFullName}},e);var a={headers:r.default.headers.getAddHeaders(t)};return n._dao.post(n.baseUrl+"/items",e,a)}).then(r.default.validateODataV2)})},e.prototype.updateItem=function(e,t,n){var o=this;return this._dao._ensureRequestDigest(n).then(function(n){return o.getItemById(e).then(function(e){t=Object.assign({},{__metadata:{type:e.__metadata.type}},t);var a={headers:r.default.headers.getUpdateHeaders(n,e.__metadata.etag)};return o._dao.post(e.__metadata.uri,t,a)})})},e.prototype.deleteItem=function(e,t){var n=this;return this._dao._ensureRequestDigest(t).then(function(t){return n.getItemById(e).then(function(e){var o={headers:r.default.headers.getDeleteHeaders(t,e.__metadata.etag)};return n._dao.post(e.__metadata.uri,"",o)})})},e}();t.default=a;var i=function(e,t){return t=t||"?",e?t+e:""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.basePermissions=[{name:"emptyMask",low:0,high:0},{name:"viewListItems",low:1,high:0},{name:"addListItems",low:2,high:0},{name:"editListItems",low:4,high:0},{name:"deleteListItems",low:8,high:0},{name:"approveItems",low:16,high:0},{name:"openItems",low:32,high:0},{name:"viewVersions",low:64,high:0},{name:"deleteVersions",low:128,high:0},{name:"cancelCheckout",low:256,high:0},{name:"managePersonalViews",low:512,high:0},{name:"manageLists",low:2048,high:0},{name:"viewFormPages",low:4096,high:0},{name:"anonymousSearchAccessList",low:8192,high:0},{name:"open",low:65536,high:0},{name:"viewPages",low:131072,high:0},{name:"addAndCustomizePages",low:262144,high:0},{name:"applyThemeAndBorder",low:524288,high:0},{name:"applyStyleSheets",low:1048576,high:0},{name:"viewUsageData",low:2097152,high:0},{name:"createSSCSite",low:4194304,high:0},{name:"manageSubwebs",low:8388608,high:0},{name:"createGroups",low:16777216,high:0},{name:"managePermissions",low:33554432,high:0},{name:"browseDirectories",low:67108864,high:0},{name:"browseUserInfo",low:134217728,high:0},{name:"addDelPrivateWebParts",low:268435456,high:0},{name:"updatePersonalWebParts",low:536870912,high:0},{name:"manageWeb",low:1073741824,high:0},{name:"anonymousSearchAccessWebLists",low:-2147483648,high:0},{name:"useClientIntegration",low:0,high:16},{name:"useRemoteAPIs",low:0,high:32},{name:"manageAlerts",low:0,high:64},{name:"createAlerts",low:0,high:128},{name:"editMyUserInfo",low:0,high:256},{name:"enumeratePermissions",low:0,high:1073741824}]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(4),a=function(){function e(e){this.baseUrl="/web",this._dao=e,this.permissions=new o.default(this.baseUrl,e)}return e.prototype.getInfo=function(){return this._dao.get(this.baseUrl).then(r.default.validateODataV2)},e.prototype.getSubsites=function(){return this._dao.get(this.baseUrl+"/webinfos").then(r.default.validateODataV2)},e.prototype.getUser=function(e){var t=e?this.baseUrl+"/SiteUsers/GetByEmail('"+e+"')":this.baseUrl+"/CurrentUser";return this._dao.get(t).then(r.default.validateODataV2)},e.prototype.ensureUser=function(e){return this._dao.post("/web/ensureUser('"+e+"')").then(r.default.validateODataV2)},e.prototype.getFile=function(e){var e="/web/getfilebyserverrelativeurl('"+e+"')";return this._dao.get(e).then(r.default.validateODataV2)},e.prototype._copyFile=function(e,t,n){var o="/web/getfilebyserverrelativeurl('"+e+"')/CopyTo",a={headers:r.default.headers.getAddHeaders(n)},i={strNewUrl:t,bOverWrite:!0};return this._dao.post(o,i,a)},e.prototype.copyFile=function(e,t,n){var r=this;return this._dao._ensureRequestDigest(n).then(function(n){return r._copyFile(e,t,n)})},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(18),a=function(){function e(e){this._dao=e}return Object.defineProperty(e.prototype,"defaultQueryOptions",{get:function(){return{sourceid:null,startrow:null,rowlimit:100,selectedproperties:null,refiners:null,refinementfilters:null,hiddencontstraints:null,sortlist:null}},enumerable:!0,configurable:!0}),e.prototype.query=function(e,t){void 0===t&&(t={});var n=r.default.qs.fromObj(t,!0),a="/search/query?querytext='"+e+"'&"+n;return this._dao.get(a).then(r.default.validateODataV2).then(function(e){if(e.query)return o.mapResponse(e.query);throw new Error("Invalid response back from search service")})},e.prototype.people=function(e,t){return void 0===t&&(t={}),t.sourceid="b09a7990-05ea-4af9-81ef-edfab16c4e31",this.query(e,t)},e.prototype.sites=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=""),void 0===n&&(n={}),t=t?"Path:"+t+"*":"";var r=(e+" contentclass:STS_Web "+t).trim();return n.rowlimit=n.rowlimit||499,this.query(r,n)},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapResponse=function(e){return{elapsedTime:e.ElapsedTime,suggestion:e.SpellingSuggestion,resultsCount:e.PrimaryQueryResult.RelevantResults.RowCount,totalResults:e.PrimaryQueryResult.RelevantResults.TotalRows,totalResultsIncludingDuplicates:e.PrimaryQueryResult.RelevantResults.TotalRowsIncludingDuplicates,items:t.mapItems(e.PrimaryQueryResult.RelevantResults.Table.Rows.results),refiners:t.mapRefiners(e.PrimaryQueryResult.RefinementResults)}},t.mapRefiners=function(e){var t=[];return e&&e.Refiners&&e.Refiners.results&&(t=e.Refiners.results.map(function(e){return{RefinerName:e.Name,RefinerOptions:e.Entries.results}})),t},t.mapItems=function(e){for(var t=[],n=0;n<e.length;n++){for(var r=e[n],o={},a=0;a<r.Cells.results.length;a++)o[r.Cells.results[a].Key]=r.Cells.results[a].Value;t.push(o)}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(20),a=function(){function e(e){this._dao=e}return e.prototype.getScope=function(e){if(3===e)return o.scopes.Web;if(2===e)return o.scopes.Site;throw new Error("Invalid Custom Action Scope")},e.prototype.get=function(e){var t=this;return this._dao.get(o.scopes.Site.url).then(r.default.validateODataV2).then(function(e){return t._dao.get(o.scopes.Web.url).then(r.default.validateODataV2).then(function(t){return e.concat(t)})}).then(function(t){if(e){var n=t.filter(function(t){return t.Name===e});if(n.length)return n[0];throw new Error("Unable to find Custom Action with name: "+e)}return t})},e.prototype._getUrl=function(e){var t=this;return this.get(e).then(function(e){return t.getScope(e.Scope).url+"('"+e.Id+"')"})},e.prototype._getUrlAndDigest=function(e){var t=this,n={};return this._getUrl(e).then(function(e){return n.url=e,t._dao.getRequestDigest()}).then(function(e){return n.digest=e,n})},e.prototype.update=function(e){var t=this;if(!e||!e.Name)throw new Error("You must at least pass a Custom Action 'Name'");return this._getUrlAndDigest(e.Name).then(function(n){e=Object.assign({},o.metadata,e);var a={headers:r.default.headers.getUpdateHeaders(n.digest)};return t._dao.post(n.url,e,a)})},e.prototype.remove=function(e){var t=this;if(!e)throw new Error("You must at least pass an existing Custom Action name");return this._getUrlAndDigest(e).then(function(e){var n={headers:r.default.headers.getDeleteHeaders(e.digest)};return t._dao.post(e.url,{},n)})},e.prototype.add=function(e){var t=this;if(!e||!e.Name)throw new Error("You must at least pass a Custom Action 'Name'");var n={Name:e.Name,Title:e.Name,Description:e.Name,Group:e.Name,Sequence:100,Scope:"Site",Location:"ScriptLink"};return e=Object.assign({},n,e),this.get().then(function(n){return!n.filter(function(t){return t.Name===e.Name}).length||t.remove(e.Name)}).then(function(){return t._dao.getRequestDigest()}).then(function(n){e=Object.assign({},o.metadata,e);var a=o.scopes[e.Scope];e.Scope=a.id;var i={headers:r.default.headers.getAddHeaders(n)};return t._dao.post(a.url,e,i)})},e.prototype.addScriptBlock=function(e,t,n){void 0===n&&(n={});var r={Name:e,ScriptBlock:t};return r=Object.assign({},r,n),this.add(r)},e.prototype.addCSSLink=function(e,t,n){void 0===n&&(n={});var r='\n\t\t(function() {\n\t\t\tvar head = document.querySelector("head");\n\t\t\tvar styleTag = document.createElement("style");\n\t\t\tstyleTag.appendChild(document.createTextNode("body { opacity: 0 }"));\n\t\t\t\n\t\t\tvar linkTag = document.createElement("link");\n\t\t\tlinkTag.rel = "stylesheet";\tlinkTag.href = "'+t+'"; linkTag.type = "text/css";\n\t\t\tlinkTag.addEventListener("load", function() {\n\t\t\t\thead.removeChild(styleTag);\n\t\t\t});\n\n\t\t\thead.appendChild(styleTag);\n\t\t\thead.appendChild(linkTag);\n\t\t})();';return this.addScriptBlock(e,r,n)},e.prototype.addScriptLink=function(e,t,n){void 0===n&&(n={});var r='\n\t\t(function() {\n\t\t\tvar head = document.querySelector("head");\n\t\t\tvar scriptTag = document.createElement("script");\n            scriptTag.src = "'+t+'";\n            scriptTag.type = "text/javascript";\n\t\t\thead.appendChild(scriptTag);\n\t\t})();';return this.addScriptBlock(e,r,n)},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.metadata={__metadata:{type:"SP.UserCustomAction"}},t.scopes={Web:{id:3,name:"Web",url:"/web/usercustomactions"},Site:{id:2,name:"Site",url:"/site/usercustomactions"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=function(){function e(e){this._dao=e,this.baseUrl="/SP.UserProfiles.PeopleManager"}return e.prototype.current=function(){var e=this.baseUrl+"/GetMyProperties";return this._dao.get(e).then(r.default.validateODataV2).then(a)},e.prototype.get=function(e){var t=this;return e?this.getUserObj(e).then(function(e){var n=encodeURIComponent(e.LoginName||e.AccountName),o=t.baseUrl+"/GetPropertiesFor(accountName=@v)?@v='"+n+"'";return t._dao.get(o).then(r.default.validateODataV2).then(a)}):this.current()},e.prototype.getUserObj=function(e){if(e&&"string"!=typeof e){if(e.AccountName||e.LoginName)return Promise.resolve(e);throw new Error("profiles.setProperty Error: Invalid user parameter")}return this._dao.web.getUser(e)},e.prototype.setProperty=function(e,t,n){var r=this;return this.getUserObj(n).then(function(n){var o={propertyName:e,propertyValue:t,accountName:n.LoginName||n.AccountName},a=r.baseUrl+"/SetSingleValueProfileProperty";return r._dao.authorizedPost(a,o)})},e}();t.default=o;var a=function(e){return e.UserProfileProperties.results.forEach(function(t){e[t.Key]=t.Value}),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(23),o=n(1),a=n(3);t.getAppOnlyToken=function(e,t,n){var s=r.parse(e);return i(e).then(function(e){var r="https://accounts.accesscontrol.windows.net/"+e.realm+"/tokens/OAuth/2",i=t+"@"+e.realm,u=e.client_id+"/"+s.host+"@"+e.realm,l={grant_type:"client_credentials",client_id:i,client_secret:n,resource:u,scope:u},c=o.stringify(l),h={method:"POST",body:c,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":c.length}};return a.default(r,h).then(function(e){return e.access_token})})};var i=function(e){var t=e+"/_api/web",n={method:"GET",headers:{Authorization:"Bearer ",Accept:"application/json;odata=verbose",response_type:"code"}};return new Promise(function(e,r){fetch(t,n).then(function(t){if(!t.ok){var n=u(s(t.headers));e(n)}r("Get Realm succeeded somehow?!")})})},s=function(e){var t="www-authenticate";return"string"==typeof e[t]?e[t]:e._headers&&Array.isArray(e._headers[t])?e._headers[t][0]:e.map&&Array.isArray(e.map[t])?e.map[t][0]:void 0},u=function(e){if(e&&e.startsWith("Bearer")){e=e.substr(7);return e.split(",").filter(function(e){return e.indexOf("=")>-1}).reduce(function(e,t){var n=t.split("=");return 2===n.length&&(e[n[0].trim()]=n[1].trim().replace(/\"/g,"")),e},{})}return null}},function(e,t,n){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function o(e,t,n){if(e&&l.isObject(e)&&e instanceof r)return e;var o=new r;return o.parse(e,t,n),o}function a(e){return l.isString(e)&&(e=o(e)),e instanceof r?e.format():r.prototype.format.call(e)}function i(e,t){return o(e,!1,!0).resolve(t)}function s(e,t){return e?o(e,!1,!0).resolveObject(t):t}var u=n(24),l=n(26);t.parse=o,t.resolve=i,t.resolveObject=s,t.format=a,t.Url=r;var c=/^([a-z0-9.+-]+:)/i,h=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,p=["<",">",'"',"`"," ","\r","\n","\t"],d=["{","}","|","\\","^","`"].concat(p),m=["'"].concat(d),g=["%","/","?",";","#"].concat(m),v=["/","?","#"],y=/^[+a-z0-9A-Z_-]{0,63}$/,b=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,w={javascript:!0,"javascript:":!0},_={javascript:!0,"javascript:":!0},O={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},S=n(1);r.prototype.parse=function(e,t,n){if(!l.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),o=-1!==r&&r<e.indexOf("#")?"?":"#",a=e.split(o),i=/\\/g;a[0]=a[0].replace(i,"/"),e=a.join(o);var s=e;if(s=s.trim(),!n&&1===e.split("#").length){var h=f.exec(s);if(h)return this.path=s,this.href=s,this.pathname=h[1],h[2]?(this.search=h[2],this.query=t?S.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var p=c.exec(s);if(p){p=p[0];var d=p.toLowerCase();this.protocol=d,s=s.substr(p.length)}if(n||p||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var j="//"===s.substr(0,2);!j||p&&_[p]||(s=s.substr(2),this.slashes=!0)}if(!_[p]&&(j||p&&!O[p])){for(var P=-1,C=0;C<v.length;C++){var R=s.indexOf(v[C]);-1!==R&&(-1===P||R<P)&&(P=R)}var I,U;U=-1===P?s.lastIndexOf("@"):s.lastIndexOf("@",P),-1!==U&&(I=s.slice(0,U),s=s.slice(U+1),this.auth=decodeURIComponent(I)),P=-1;for(var C=0;C<g.length;C++){var R=s.indexOf(g[C]);-1!==R&&(-1===P||R<P)&&(P=R)}-1===P&&(P=s.length),this.host=s.slice(0,P),s=s.slice(P),this.parseHost(),this.hostname=this.hostname||"";var A="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var x=this.hostname.split(/\./),C=0,T=x.length;C<T;C++){var N=x[C];if(N&&!N.match(y)){for(var k="",D=0,q=N.length;D<q;D++)N.charCodeAt(D)>127?k+="x":k+=N[D];if(!k.match(y)){var E=x.slice(0,C),M=x.slice(C+1),V=N.match(b);V&&(E.push(V[1]),M.unshift(V[2])),M.length&&(s="/"+M.join(".")+s),this.hostname=E.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=u.toASCII(this.hostname));var F=this.port?":"+this.port:"",L=this.hostname||"";this.host=L+F,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!w[d])for(var C=0,T=m.length;C<T;C++){var B=m[C];if(-1!==s.indexOf(B)){var H=encodeURIComponent(B);H===B&&(H=escape(B)),s=s.split(B).join(H)}}var G=s.indexOf("#");-1!==G&&(this.hash=s.substr(G),s=s.slice(0,G));var W=s.indexOf("?");if(-1!==W?(this.search=s.substr(W),this.query=s.substr(W+1),t&&(this.query=S.parse(this.query)),s=s.slice(0,W)):t&&(this.search="",this.query={}),s&&(this.pathname=s),O[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var F=this.pathname||"",z=this.search||"";this.path=F+z}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,a="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(a=S.stringify(this.query));var i=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||O[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),i&&"?"!==i.charAt(0)&&(i="?"+i),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),i=i.replace("#","%23"),t+o+n+i+r},r.prototype.resolve=function(e){return this.resolveObject(o(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(l.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,o=Object.keys(this),a=0;a<o.length;a++){var i=o[a];n[i]=this[i]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),u=0;u<s.length;u++){var c=s[u];"protocol"!==c&&(n[c]=e[c])}return O[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!O[e.protocol]){for(var h=Object.keys(e),f=0;f<h.length;f++){var p=h[f];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||_[e.protocol])n.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var m=n.pathname||"",g=n.search||"";n.path=m+g}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),y=e.host||e.pathname&&"/"===e.pathname.charAt(0),b=y||v||n.host&&e.pathname,w=b,S=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],j=n.protocol&&!O[n.protocol];if(j&&(n.hostname="",n.port=null,n.host&&(""===S[0]?S[0]=n.host:S.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),b=b&&(""===d[0]||""===S[0])),y)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,S=d;else if(d.length)S||(S=[]),S.pop(),S=S.concat(d),n.search=e.search,n.query=e.query;else if(!l.isNullOrUndefined(e.search)){if(j){n.hostname=n.host=S.shift();var P=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");P&&(n.auth=P.shift(),n.host=n.hostname=P.shift())}return n.search=e.search,n.query=e.query,l.isNull(n.pathname)&&l.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!S.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var C=S.slice(-1)[0],R=(n.host||e.host||S.length>1)&&("."===C||".."===C)||""===C,I=0,U=S.length;U>=0;U--)C=S[U],"."===C?S.splice(U,1):".."===C?(S.splice(U,1),I++):I&&(S.splice(U,1),I--);if(!b&&!w)for(;I--;I)S.unshift("..");!b||""===S[0]||S[0]&&"/"===S[0].charAt(0)||S.unshift(""),R&&"/"!==S.join("/").substr(-1)&&S.push("");var A=""===S[0]||S[0]&&"/"===S[0].charAt(0);if(j){n.hostname=n.host=A?"":S.length?S.shift():"";var P=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");P&&(n.auth=P.shift(),n.host=n.hostname=P.shift())}return b=b||n.host&&S.length,b&&!A&&S.unshift(""),S.length?n.pathname=S.join("/"):(n.pathname=null,n.path=null),l.isNull(n.pathname)&&l.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=h.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){(function(e,r){var o;!function(a){function i(e){throw new RangeError(T[e])}function s(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function u(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(x,"."),r+s(e.split("."),t).join(".")}function l(e){for(var t,n,r=[],o=0,a=e.length;o<a;)t=e.charCodeAt(o++),t>=55296&&t<=56319&&o<a?(n=e.charCodeAt(o++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--)):r.push(t);return r}function c(e){return s(e,function(e){var t="";return e>65535&&(e-=65536,t+=D(e>>>10&1023|55296),e=56320|1023&e),t+=D(e)}).join("")}function h(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:_}function f(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function p(e,t,n){var r=0;for(e=n?k(e/P):e>>1,e+=k(e/t);e>N*S>>1;r+=_)e=k(e/N);return k(r+(N+1)*e/(e+j))}function d(e){var t,n,r,o,a,s,u,l,f,d,m=[],g=e.length,v=0,y=R,b=C;for(n=e.lastIndexOf(I),n<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&i("not-basic"),m.push(e.charCodeAt(r));for(o=n>0?n+1:0;o<g;){for(a=v,s=1,u=_;o>=g&&i("invalid-input"),l=h(e.charCodeAt(o++)),(l>=_||l>k((w-v)/s))&&i("overflow"),v+=l*s,f=u<=b?O:u>=b+S?S:u-b,!(l<f);u+=_)d=_-f,s>k(w/d)&&i("overflow"),s*=d;t=m.length+1,b=p(v-a,t,0==a),k(v/t)>w-y&&i("overflow"),y+=k(v/t),v%=t,m.splice(v++,0,y)}return c(m)}function m(e){var t,n,r,o,a,s,u,c,h,d,m,g,v,y,b,j=[];for(e=l(e),g=e.length,t=R,n=0,a=C,s=0;s<g;++s)(m=e[s])<128&&j.push(D(m));for(r=o=j.length,o&&j.push(I);r<g;){for(u=w,s=0;s<g;++s)(m=e[s])>=t&&m<u&&(u=m);for(v=r+1,u-t>k((w-n)/v)&&i("overflow"),n+=(u-t)*v,t=u,s=0;s<g;++s)if(m=e[s],m<t&&++n>w&&i("overflow"),m==t){for(c=n,h=_;d=h<=a?O:h>=a+S?S:h-a,!(c<d);h+=_)b=c-d,y=_-d,j.push(D(f(d+b%y,0))),c=k(b/y);j.push(D(f(c,0))),a=p(n,v,r==o),n=0,++r}++n,++t}return j.join("")}function g(e){return u(e,function(e){return U.test(e)?d(e.slice(4).toLowerCase()):e})}function v(e){return u(e,function(e){return A.test(e)?"xn--"+m(e):e})}var y=("object"==typeof t&&t&&t.nodeType,"object"==typeof e&&e&&e.nodeType,"object"==typeof r&&r);var b,w=2147483647,_=36,O=1,S=26,j=38,P=700,C=72,R=128,I="-",U=/^xn--/,A=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},N=_-O,k=Math.floor,D=String.fromCharCode;b={version:"1.4.1",ucs2:{decode:l,encode:c},decode:d,encode:m,toASCII:v,toUnicode:g},void 0!==(o=function(){return b}.call(t,n,t,e))&&(e.exports=o)}()}).call(t,n(25)(e),n(2))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";function r(e){return function(t){var n=t.FormContext,r=Object.assign({},t);return e.onReady&&(n?n.registerInitCallback(e.name,e.onReady.bind(null,r)):setTimeout(e.onReady.bind(null,r),100)),e.getValue&&n&&n.registerGetValueCallback(e.name,e.getValue.bind(null,r)),n&&n.updateControlValue&&(e.setValue=function(t){n.updateControlValue(e.name,t)}),e.render(t)}}function o(e){return function(t){var n=t.FormContext;return n&&n.registerInitCallback&&e.onReady&&n.registerInitCallback(e.name,e.onReady),e.render(t)}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),i=function(e,t,n){if(void 0===n&&(n={}),!a.default.validateNamespace("SPClientTemplates.TemplateManager"))throw new Error("Unable to register CSR template.  SPClientTemplates.TemplateManager does not exist");var r={};e.locations.forEach(function(e){return r[e]=t});var o={Templates:{Fields:{}}},i=Object.assign({},o,n);return i.Templates.Fields[e.name]=r,SPClientTemplates.TemplateManager.RegisterTemplateOverrides(i),e},s=function(e,t){void 0===t&&(t={});var n=o(e);return e.locations=e.locations||["View","DisplayForm"],i(e,n,t)},u=function(e,t){void 0===t&&(t={});var n=r(e);return e.locations=e.locations||["NewForm","EditForm"],i(e,n,t)},l={registerDisplayField:s,registerFormField:u};t.default=l}])});
//# sourceMappingURL=spscript.js.map